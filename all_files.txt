
===== FILE: all_files.txt =====


===== FILE: demo.html =====
<!DOCTYPE html>
<html lang="en" data-theme="codecademy">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SkillTree Codecademy Theme Demo</title>

  <!-- Tailwind + DaisyUI via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      plugins: [require('daisyui')],
      daisyui: {
        themes: ['codecademy']
      }
    }
  </script>

  <!-- Lucide Icons -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/lucide.min.js"></script>
</head>
<body class="flex h-screen bg-neutral text-base-content font-sans">

  <!-- Sidebar -->
  <aside class="w-60 bg-base-100 border-r p-6 flex flex-col">
    <h2 class="text-lg font-bold mb-8">Dashboard</h2>
    <nav class="flex-1 space-y-4">
      <a class="flex items-center space-x-2 px-3 py-2 rounded hover:bg-secondary hover:bg-opacity-20" href="#">
        <i data-lucide="layout"></i><span>Dashboard</span>
      </a>
      <a class="flex items-center space-x-2 px-3 py-2 rounded hover:bg-secondary hover:bg-opacity-20" href="#">
        <i data-lucide="book-open"></i><span>My learning</span>
      </a>
      <a class="flex items-center space-x-2 px-3 py-2 rounded hover:bg-secondary hover:bg-opacity-20" href="#">
        <i data-lucide="calendar"></i><span>Events</span>
      </a>
      <a class="flex items-center space-x-2 px-3 py-2 rounded hover:bg-secondary hover:bg-opacity-20" href="#">
        <i data-lucide="layout-list"></i><span>Projects</span>
      </a>
      <a class="flex items-center space-x-2 px-3 py-2 rounded hover:bg-secondary hover:bg-opacity-20" href="#">
        <i data-lucide="code"></i><span>Workspaces</span>
      </a>
    </nav>
    <div class="mt-8 p-4 border rounded-lg bg-base-200">
      <h3 class="font-bold mb-2">Try Plus or Pro</h3>
      <p class="text-sm mb-4">7-day free trial. Go deeper, earn certificates.</p>
      <button class="btn btn-primary btn-block">Try for free</button>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col overflow-auto">

    <!-- Top Navbar Spacer -->
    <header class="bg-base-100 border-b p-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold">SkillTree</h1>
      <div class="space-x-4">
        <a class="hover:underline" href="#">Log In</a>
        <button class="btn btn-primary btn-sm">Sign Up</button>
      </div>
    </header>

    <main class="p-6 space-y-8 flex-1">

      <!-- Bootcamp Promo -->
      <section>
        <h2 class="text-xl font-semibold mb-4">Codecademy Bootcamps</h2>
        <div class="bg-secondary p-6 rounded-lg flex items-center justify-between space-x-6">
          <div>
            <h3 class="text-lg font-bold">Full Stack Developer Bootcamp for Beginners</h3>
            <p class="mt-2">Join our expert‚Äêled bootcamp to gain in-demand skills</p>
            <a class="mt-4 inline-block text-primary font-semibold" href="#">Register now ‚Üí</a>
          </div>
          <img src="https://via.placeholder.com/120x80.png?text=üéì" alt="bootcamp" />
        </div>
      </section>

      <!-- Keep Learning Card -->
      <section>
        <h2 class="text-xl font-semibold mb-4">Keep learning</h2>
        <div class="bg-base-100 rounded-lg shadow-lg overflow-hidden border">

          <!-- Progress Bar -->
          <div class="h-8 flex">
            <div class="bg-secondary w-0 md:w-1/3 flex items-center justify-center text-sm font-bold">
              33%
            </div>
            <div class="bg-base-200 flex-1"></div>
          </div>

          <!-- Content -->
          <div class="md:flex">
            <div class="p-6 flex-1">
              <p class="text-xs uppercase opacity-70">Course</p>
              <h3 class="text-lg font-bold">Learn Python 3</h3>
              <p class="mt-1 text-sm opacity-70">Current Module: Hello World</p>
            </div>
            <div class="border-l p-6 flex-1">
              <h4 class="font-semibold mb-2">Make a study plan</h4>
              <p class="text-sm opacity-70 mb-4">Build a learning rhythm that fits your schedule.</p>
              <button class="btn btn-outline btn-sm mr-2">Make a plan</button>
              <button class="btn btn-ghost btn-sm">Dismiss</button>
            </div>
          </div>

          <!-- Footer Actions -->
          <div class="bg-primary text-white p-4 text-center">
            <button class="font-semibold flex items-center justify-center w-full">
              Resume <i data-lucide="arrow-right" class="ml-2"></i>
            </button>
          </div>
        </div>
      </section>

      <!-- Follow your progress -->
      <section>
        <h2 class="text-xl font-semibold mb-4">Follow your progress</h2>
        <div class="bg-base-100 p-6 rounded-lg shadow-lg">
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <h4 class="text-sm font-medium mb-2">Computer science</h4>
              <div class="h-2 bg-base-200 rounded overflow-hidden mb-1">
                <div class="h-full bg-secondary w-4/5"></div>
              </div>
              <p class="text-xs opacity-70">80 XP</p>
            </div>

            <div>
              <h4 class="text-sm font-medium mb-2">IT</h4>
              <div class="h-2 bg-base-200 rounded overflow-hidden mb-1">
                <div class="h-full bg-secondary w-3/4"></div>
              </div>
              <p class="text-xs opacity-70">70 XP</p>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script>
    // Activate Lucide icons
    lucide.replace();
  </script>
</body>
</html>


===== FILE: backend\.env =====
MONGO_URI=mongodb+srv://hasinishrak2015:Hda8fm5in8TOPAdv@cluster0.gfpd7tx.mongodb.net/skilltree_db?retryWrites=true&w=majority&appName=Cluster0
PORT=5001

===== FILE: backend\package.json =====
{
  "name": "backend",
  "version": "1.0.0",
  "main": "src/server.js",
  "scripts": {
    "dev": "nodemon src/server.js",
    "start": "node src/server.js"
  },
  "type": "module",
  "keywords": [],
  "author": "",
  "license": "ISC",
  "description": "",
  "dependencies": {
    "bcrypt": "^6.0.0",
    "cors": "^2.8.5",
    "dotenv": "^16.5.0",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.2",
    "mongoose": "^8.14.3"
  },
  "devDependencies": {
    "nodemon": "^3.1.10"
  }
}


===== FILE: frontend\.gitignore =====
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?


===== FILE: frontend\eslint.config.js =====
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


===== FILE: frontend\index.html =====
<!doctype html>
<html lang="en" data-theme="light-forest">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/489/489969.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkillTree</title>
  </head>
  <body class="h-full">
    <div id="root" class="h-full"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>


===== FILE: frontend\package.json =====
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.11.0",
    "lucide-react": "^0.536.0",
    "react": "^19.1.0",
    "react-dom": "^19.1.0",
    "react-hot-toast": "^2.5.2",
    "react-router-dom": "^7.7.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.30.1",
    "@types/react": "^19.1.8",
    "@types/react-dom": "^19.1.6",
    "@vitejs/plugin-react": "^4.6.0",
    "autoprefixer": "^10.4.21",
    "daisyui": "^4.12.24",
    "eslint": "^9.30.1",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^16.3.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "vite": "^7.0.4"
  }
}


===== FILE: frontend\postcss.config.js =====
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


===== FILE: frontend\README.md =====
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.


===== FILE: frontend\tailwind.config.js =====
import daisyui from "daisyui";

/** @type {import('tailwindcss').Config} */
export default {
  content: ["./index.html", "./src/**/*.{js,jsx}"],
  theme: { extend: {} },
  plugins: [daisyui],
  daisyui: {
    themes: [
      // your custom light-forest theme
      {
        "light-forest": {
          "primary": "#237a57",
          "primary-focus": "#186649",
          "primary-content": "#ffffff",
          "secondary": "#3eae62",
          "secondary-focus": "#329858",
          "secondary-content": "#96C97B",
          "accent": "#becc24",
          "accent-focus": "#a6b01e",
          "accent-content": "#ffffff",
          "neutral": "#E3FFCF",
          "neutral-focus": "#e5e5e5",
          "neutral-content": "#253235",
          "base-100": "#ffffff",
          "base-200": "#f2f2f2",
          "base-300": "#e5e5e5",
          "base-content": "#253235",
          "info": "#2094f3",
          "success": "#009485",
          "warning": "#ff9900",
          "error": "#ff5724"
        }
      },
      // DaisyUI‚Äôs built-in dark ‚Äúforest‚Äù
      "forest"
    ],
  },
};


===== FILE: frontend\vite.config.js =====
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})


===== FILE: backend\src\server.js =====
import express from "express";
import cors from "cors";
import dotenv from "dotenv";
import { connectDB } from "./config/db.js";
import skillsRoutes from "./routes/skillsRoutes.js";
import authRoutes from "./routes/authRoutes.js";
import learningRoutes from "./routes/learningRoutes.js";
import usersRoutes from "./routes/usersRoutes.js";
import streakRoutes from "./routes/streakRoutes.js";
import reflectionsRoutes from "./routes/reflectionsRoutes.js";
import shopRoutes from "./routes/shopRoutes.js";

dotenv.config();
connectDB();

const app = express();
app.use(cors());
app.use(express.json());

app.use("/api/skills", skillsRoutes);
app.use("/api/auth", authRoutes);
app.use("/api/learning", learningRoutes);
app.use("/api/users", usersRoutes);
app.use("/api/streak", streakRoutes);
app.use("/api/reflections", reflectionsRoutes);
// NEW:
app.use("/api/shop", shopRoutes);

const PORT = process.env.PORT || 5001;
app.listen(PORT, () => console.log("Server running on port", PORT));


===== FILE: backend\src\config\coins.js =====
// Single source of truth for COINS values (simple mode, no caps)
export const COINS_PER_TASK = 2; // base reward per completed task

// One-time per skill when crossing these completion % thresholds.
export const MILESTONE_BONUSES = {
  25: 3,
  50: 5,
  75: 7,
  100: 10,
};

// NOTE: No daily caps, no streak bonuses, no reflection bonuses.


===== FILE: backend\src\config\db.js =====
import mongoose from "mongoose";

export const connectDB = async () => {
    try{
        await mongoose.connect(process.env.MONGO_URI);

        console.log("MONGODB CONNECTED SUCCESSFULLY"); 

    }
    catch (error){
        console.error("Error connectring to Mongodb", error);
        process.exit(1);
    } 

}

===== FILE: backend\src\config\ranks.js =====
// backend/src/config/ranks.js

// Ordered lowest -> highest
export const RANKS = [
  { key: "unranked", name: "Unranked", minXp: 0 },
  { key: "bronze",   name: "Bronze",   minXp: 100 },
  { key: "silver",   name: "Silver",   minXp: 200 },
  { key: "gold",     name: "Gold",     minXp: 500 },
  { key: "diamond",  name: "Diamond",  minXp: 750 },
  { key: "mythic",   name: "Mythic",   minXp: 1000 },
];

export function getRankForXp(xp = 0) {
  let current = RANKS[0];
  let next = null;

  for (let i = 0; i < RANKS.length; i++) {
    if (xp >= RANKS[i].minXp) {
      current = RANKS[i];
      next = RANKS[i + 1] || null;
    }
  }

  const floor = current.minXp;
  const ceil  = next ? next.minXp : Math.max(floor + 1, xp); // avoid zero range
  const range = Math.max(1, ceil - floor);
  const raw   = ((xp - floor) / range) * 100;
  const progressToNext = Math.max(0, Math.min(100, Math.round(raw)));
  const toNext = next ? Math.max(0, next.minXp - xp) : 0;

  return { current, next, progressToNext, toNext };
}


===== FILE: backend\src\config\shop.js =====
// backend/src/config/shop.js
// Icon files are served by the frontend at /shop/<id>.png (public folder).
// Make sure you place your PNGs in: frontend/public/shop/

export const SHOP_ITEMS = [
  { id: "leaf-banner",   name: "Leaf Banner",   price: 8,  icon: "/shop/leaf-banner.png",   desc: "A leafy banner to hang on trees." },
  { id: "bird-house",    name: "Bird House",    price: 15, icon: "/shop/bird-house.png",    desc: "A cozy home for your pixel-birds." },
  { id: "fairy-lights",  name: "Fairy Lights",  price: 20, icon: "/shop/fairy-lights.png",  desc: "String lights that twinkle at dusk." },
  { id: "tree-ribbon",   name: "Tree Ribbon",   price: 10, icon: "/shop/tree-ribbon.png",   desc: "Tie a pretty ribbon around a trunk." },
  { id: "ground-rocks",  name: "Ground Rocks",  price: 6,  icon: "/shop/ground-rocks.png",  desc: "Decorative stones for the base." },
  { id: "mushroom-pack", name: "Mushroom Pack", price: 12, icon: "/shop/mushroom-pack.png", desc: "Cute mushrooms to place nearby." },
  { id: "wind-chime",    name: "Wind Chime",    price: 18, icon: "/shop/wind-chime.png",    desc: "Soft chimes in the pixel breeze." },
  { id: "tree-plaque",   name: "Tree Plaque",   price: 9,  icon: "/shop/tree-plaque.png",   desc: "Nameplate to label a tree." },
];


===== FILE: backend\src\config\xp.js =====
// Single source of truth for XP values
export const XP_PER_TASK = 10;


===== FILE: backend\src\controllers\authController.js =====
import User from "../models/User.js";
import jwt from "jsonwebtoken";
import { XP_PER_TASK } from "../config/xp.js";
import { COINS_PER_TASK, MILESTONE_BONUSES } from "../config/coins.js";
import { getRankForXp } from "../config/ranks.js";

const JWT_SECRET = process.env.JWT_SECRET || "replace_this_with_env_secret";

function computeXpFromLearning(user) {
  if (!user?.learningSkills?.length) return 0;
  let doneTasks = 0;
  for (const e of user.learningSkills) {
    if (Array.isArray(e.completedTasks)) doneTasks += e.completedTasks.filter(Boolean).length;
  }
  return doneTasks * XP_PER_TASK;
}

function computeCoinsFromLearning(user) {
  let base = 0;
  let milestoneSum = 0;
  for (const e of user.learningSkills) {
    if (!e || !Array.isArray(e.completedTasks)) continue;
    const total = e.completedTasks.length;
    const done  = e.completedTasks.filter(Boolean).length;
    base += done * COINS_PER_TASK;

    const pct = total ? Math.round((done / total) * 100) : 0;
    if (!e.milestones) e.milestones = new Map();
    for (const t of [25,50,75,100]) {
      const k = String(t);
      const already = e.milestones.get(k) || false;
      if (pct >= t && !already) {
        milestoneSum += (MILESTONE_BONUSES[t] || 0);
        e.milestones.set(k, true);
      }
    }
  }
  return { totalCoins: base + milestoneSum };
}

export async function register(req, res) {
  try {
    const { username, password } = req.body;
    if (!username || !password) return res.status(400).json({ message: "Missing fields" });
    if (await User.findOne({ username })) return res.status(409).json({ message: "Username taken" });

    const user = await new User({ username, password }).save();
    const token = jwt.sign({ id: user._id, isAdmin: user.isAdmin }, JWT_SECRET, { expiresIn: "7d" });
    const rank = getRankForXp(user.xp || 0);

    res.status(201).json({
      username: user.username,
      token,
      isAdmin: user.isAdmin,
      xp: user.xp,
      xpPerTask: XP_PER_TASK,
      coins: user.coins,
      rank,
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

export async function login(req, res) {
  try {
    const { username, password } = req.body;
    if (!username || !password) return res.status(400).json({ message: "Missing fields" });

    const user = await User.findOne({ username });
    if (!user || !(await user.comparePassword(password))) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    // Reconcile XP and baseline coins (no caps)
    const computedXp = computeXpFromLearning(user);
    if (user.xp !== computedXp) user.xp = computedXp;

    const { totalCoins: baseline } = computeCoinsFromLearning(user);
    if (user.coins < baseline) user.coins = baseline;

    await user.save();

    const token = jwt.sign({ id: user._id, isAdmin: user.isAdmin }, JWT_SECRET, { expiresIn: "7d" });
    const rank = getRankForXp(user.xp || 0);

    res.json({
      username: user.username,
      token,
      isAdmin: user.isAdmin,
      xp: user.xp,
      xpPerTask: XP_PER_TASK,
      coins: user.coins,
      rank,
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}


===== FILE: backend\src\controllers\learningController.js =====
import User from "../models/User.js";
import Skill from "../models/Skill.js";
import { XP_PER_TASK } from "../config/xp.js";
import { COINS_PER_TASK, MILESTONE_BONUSES } from "../config/coins.js";
import crypto from "crypto";

/* ----------------- Helpers ----------------- */
function isSkillCompleted(entry, skillDoc) {
  const total = skillDoc?.tasks?.length ?? entry.completedTasks.length;
  if (!total) return false;
  if (!entry.completedTasks || entry.completedTasks.length !== total) return false;
  return entry.completedTasks.every(Boolean);
}
function countByItem(list = []) {
  const m = new Map();
  for (const d of list) m.set(d.itemId, (m.get(d.itemId) || 0) + 1);
  return m;
}

/* ----------------- Start / Read ----------------- */
export async function startLearning(req, res) {
  try {
    const user = await User.findById(req.user.id);
    const skill = await Skill.findById(req.params.skillId);
    if (!skill) return res.status(404).json({ message: "Skill not found" });

    const exists = user.learningSkills.some((e) => e.skill.equals(skill._id));
    if (!exists) {
      user.learningSkills.push({
        skill: skill._id,
        completedTasks: Array(skill.tasks.length).fill(false),
        milestones: {},
        decorations: [],
      });
      await user.save();
    }
    res.json({ message: "Skill added" });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

export async function getLearningSkills(req, res) {
  try {
    const user = await User.findById(req.user.id).populate("learningSkills.skill");

    const before = user.learningSkills.length;
    user.learningSkills = user.learningSkills.filter((e) => !!e.skill);
    if (user.learningSkills.length !== before) await user.save();

    const payload = user.learningSkills.map((e) => ({
      _id: e.skill._id,
      name: e.skill.name,
      category: e.skill.category,
      tasks: e.skill.tasks,
      completedTasks: e.completedTasks,
      xpPerTask: XP_PER_TASK,
    }));
    res.json(payload);
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

export async function getLearningSkill(req, res) {
  try {
    const user = await User.findById(req.user.id).populate("learningSkills.skill");
    const entry = user.learningSkills.find(
      (e) => e.skill && e.skill._id.equals(req.params.skillId)
    );
    if (!entry) return res.status(404).json({ message: "Not learning this skill" });

    res.json({
      _id: entry.skill._id,
      name: entry.skill.name,
      category: entry.skill.category,
      tasks: entry.skill.tasks,
      completedTasks: entry.completedTasks,
      xpPerTask: XP_PER_TASK,
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

/* ----------------- Toggle task (existing) ----------------- */
export async function toggleTask(req, res) {
  try {
    const idx = parseInt(req.params.taskIndex, 10);
    const user = await User.findById(req.user.id);
    const entry = user.learningSkills.find((e) => e.skill.equals(req.params.skillId));
    if (!entry) return res.status(404).json({ message: "Not learning this skill" });

    const skillDoc = await Skill.findById(req.params.skillId);
    if (skillDoc) {
      const needed = skillDoc.tasks.length;
      if (entry.completedTasks.length !== needed) {
        entry.completedTasks = Array(needed)
          .fill(false)
          .map((_, i) => entry.completedTasks[i] || false);
      }
    }
    if (Number.isNaN(idx) || idx < 0 || idx >= entry.completedTasks.length) {
      return res.status(400).json({ message: "Invalid task index" });
    }

    const wasCompleted = !!entry.completedTasks[idx];
    entry.completedTasks[idx] = !wasCompleted;
    entry.lastUpdated = new Date();

    let deltaXp = 0;
    if (!wasCompleted) {
      deltaXp = XP_PER_TASK;
      user.xp += XP_PER_TASK;
    } else {
      deltaXp = -XP_PER_TASK;
      user.xp = Math.max(0, user.xp - XP_PER_TASK);
    }

    let deltaCoins = 0;
    let awardedMilestones = [];

    if (!wasCompleted) {
      user.coins += COINS_PER_TASK;
      deltaCoins += COINS_PER_TASK;
      user.coinTransactions.push({
        type: "earn",
        amount: COINS_PER_TASK,
        reason: "task_complete",
        skill: entry.skill,
        meta: { taskIndex: idx },
        createdAt: new Date(),
      });
    } else {
      const sub = COINS_PER_TASK;
      user.coins = Math.max(0, user.coins - sub);
      deltaCoins -= sub;
      user.coinTransactions.push({
        type: "earn",
        amount: 0,
        reason: "unmark_task",
        skill: entry.skill,
        meta: { taskIndex: idx, reversed: COINS_PER_TASK },
        createdAt: new Date(),
      });
    }

    const total = entry.completedTasks.length || (skillDoc ? skillDoc.tasks.length : 0);
    const done = entry.completedTasks.filter(Boolean).length;
    const pct  = total ? Math.round((done / total) * 100) : 0;

    if (!wasCompleted && total > 0) {
      for (const t of [25, 50, 75, 100]) {
        const already = entry.milestones?.get(String(t)) || false;
        if (pct >= t && !already) {
          const bonus = MILESTONE_BONUSES[t] || 0;
          if (bonus > 0) {
            user.coins += bonus;
            deltaCoins += bonus;
            awardedMilestones.push(t);
            user.coinTransactions.push({
              type: "earn",
              amount: bonus,
              reason: `milestone_${t}`,
              skill: entry.skill,
              meta: { percent: t },
              createdAt: new Date(),
            });
          }
          entry.milestones.set(String(t), true);
        }
      }
    }

    await user.save();

    res.json({
      completedTasks: entry.completedTasks,
      xp: user.xp,
      deltaXp,
      coins: user.coins,
      deltaCoins,
      awardedMilestones,
      coinsPerTask: COINS_PER_TASK,
      milestoneBonuses: MILESTONE_BONUSES,
      xpPerTask: XP_PER_TASK,
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

/* ----------------- Decorations (NEW) ----------------- */
// GET /api/learning/:skillId/decorations
export async function getDecorations(req, res) {
  try {
    const user = await User.findById(req.user.id).populate("learningSkills.skill");
    const entry = user.learningSkills.find(e => e.skill && e.skill._id.equals(req.params.skillId));
    if (!entry) return res.status(404).json({ message: "Not learning this skill" });
    res.json({ decorations: entry.decorations || [] });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

// PUT /api/learning/:skillId/decorations { decorations: [{id,itemId,xPct,yPct}] }
export async function saveDecorations(req, res) {
  try {
    const user = await User.findById(req.user.id).populate("learningSkills.skill");
    const entry = user.learningSkills.find(e => e.skill && e.skill._id.equals(req.params.skillId));
    if (!entry) return res.status(404).json({ message: "Not learning this skill" });

    const skillDoc = entry.skill;
    if (!isSkillCompleted(entry, skillDoc)) {
      return res.status(403).json({ message: "Decorations allowed only when the tree is 100% complete" });
    }

    const incoming = Array.isArray(req.body?.decorations) ? req.body.decorations : [];
    for (const d of incoming) {
      d.id    = String(d.id || crypto.randomUUID());
      d.itemId= String(d.itemId);
      d.xPct  = Math.max(0, Math.min(100, Number(d.xPct)));
      d.yPct  = Math.max(0, Math.min(100, Number(d.yPct)));
    }

    const prev = entry.decorations || [];
    const prevCounts = countByItem(prev);
    const nextCounts = countByItem(incoming);

    // Validate: need enough inventory for net-new placements
    for (const [itemId, nextCount] of nextCounts.entries()) {
      const old = prevCounts.get(itemId) || 0;
      const delta = nextCount - old; // >0 means take from inventory
      if (delta > 0) {
        const inv = user.inventory.find(i => i.itemId === itemId);
        if ((inv?.qty ?? 0) < delta) {
          return res.status(400).json({ message: `Not enough "${itemId}" in inventory (${delta} more needed)` });
        }
      }
    }

    // Return removed items
    for (const [itemId, oldCount] of prevCounts.entries()) {
      const nextCount = nextCounts.get(itemId) || 0;
      const delta = nextCount - oldCount; // negative => return
      if (delta < 0) {
        const inv = user.inventory.find(i => i.itemId === itemId);
        if (inv) inv.qty += Math.abs(delta); else user.inventory.push({ itemId, qty: Math.abs(delta) });
      }
    }
    // Consume new items
    for (const [itemId, nextCount] of nextCounts.entries()) {
      const oldCount = prevCounts.get(itemId) || 0;
      const delta = nextCount - oldCount; // positive => spend
      if (delta > 0) {
        const inv = user.inventory.find(i => i.itemId === itemId);
        if (inv) { inv.qty -= delta; if (inv.qty < 0) inv.qty = 0; }
      }
    }

    entry.decorations = incoming;
    entry.lastUpdated = new Date();
    await user.save();

    res.json({ decorations: entry.decorations, inventory: user.inventory });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}


===== FILE: backend\src\controllers\reflectionsController.js =====
import User from "../models/User.js";

export async function submitReflection(req, res) {
  try {
    const user = await User.findById(req.user.id);

    // Track week so users can't spam the endpoint, but we award no coins.
    const d = new Date();
    const wk = `${d.getUTCFullYear()}-W${String(
      Math.ceil((((Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate()) -
        Date.UTC(d.getUTCFullYear(), 0, 1)) /
        86400000) +
        1) /
        7)
    ).padStart(2, "0")}`;

    if (!user.reflectionWeeks.includes(wk)) {
      user.reflectionWeeks.push(wk);
      await user.save();
    }

    res.json({ coins: user.coins, deltaCoins: 0, week: wk, reflectionsCoinsDisabled: true });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}


===== FILE: backend\src\controllers\shopController.js =====
// backend/src/controllers/shopController.js
import User from "../models/User.js";
import { SHOP_ITEMS } from "../config/shop.js";

export function getItems(req, res) {
  res.json(SHOP_ITEMS);
}

export async function buyItem(req, res) {
  try {
    const { itemId } = req.params;
    const item = SHOP_ITEMS.find((it) => it.id === itemId);
    if (!item) return res.status(404).json({ message: "Item not found" });

    const user = await User.findById(req.user.id);
    if (!user) return res.status(404).json({ message: "User not found" });

    if (user.coins < item.price) {
      return res.status(400).json({ message: "Not enough coins" });
    }

    user.coins -= item.price;
    user.coinTransactions.push({
      type: "spend",
      amount: item.price,
      reason: "shop_purchase",
      skill: null,
      meta: { itemId: item.id, itemName: item.name },
      createdAt: new Date(),
    });

    const existing = user.inventory.find((i) => i.itemId === item.id);
    if (existing) {
      existing.qty += 1;
    } else {
      user.inventory.push({ itemId: item.id, qty: 1, acquiredAt: new Date() });
    }

    await user.save();
    res.json({
      message: `Purchased ${item.name}`,
      coins: user.coins,
      inventory: user.inventory,
      purchased: { itemId: item.id, name: item.name, price: item.price },
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}


===== FILE: backend\src\controllers\skillsController.js =====
import Skill from "../models/Skill.js";
import User from "../models/User.js";

export async function getAllSkills(req, res) {
  try {
    const skills = await Skill.find().sort({ createdAt: -1 });
    res.json(skills);
  } catch {
    res.status(500).json({ message: "Internal server error" });
  }
}

export async function getSkillById(req, res) {
  try {
    const skill = await Skill.findById(req.params.id);
    if (!skill) return res.status(404).json({ message: "Skill not found" });
    res.json(skill);
  } catch {
    res.status(500).json({ message: "Internal server error" });
  }
}

export async function createSkill(req, res) {
  try {
    const { name, category, tasks } = req.body;
    const created = await new Skill({ name, category, tasks }).save();
    res.status(201).json(created);
  } catch {
    res.status(500).json({ message: "Internal server error" });
  }
}

export async function updateSkill(req, res) {
  try {
    const { name, category, tasks } = req.body;
    const updated = await Skill.findByIdAndUpdate(
      req.params.id,
      { name, category, tasks },
      { new: true }
    );
    if (!updated) return res.status(404).json({ message: "Skill not found" });
    res.json(updated);
  } catch {
    res.status(500).json({ message: "Internal server error" });
  }
}

export async function deleteSkill(req, res) {
  try {
    const inUse = await User.exists({ "learningSkills.skill": req.params.id });
    if (inUse) {
      return res
        .status(409)
        .json({ message: "Cannot delete: users are learning this skill" });
    }

    const deleted = await Skill.findByIdAndDelete(req.params.id);
    if (!deleted) return res.status(404).json({ message: "Skill not found" });
    res.json({ message: "Skill deleted" });
  } catch {
    res.status(500).json({ message: "Internal server error" });
  }
}


export async function createCustomSkill(req, res) {
  try {
    const { name, category, tasks } = req.body;
    if (!name || !category || !Array.isArray(tasks)) {
      return res.status(400).json({ message: "Invalid payload" });
    }
    const customName = name.includes("(Custom)") ? name : `${name} (Custom)`;
    const created = await new Skill({ name: customName, category, tasks }).save();
    res.status(201).json(created);
  } catch {
    res.status(500).json({ message: "Internal server error" });
  }
}


===== FILE: backend\src\controllers\streakController.js =====
import User from "../models/User.js";

export async function tickStreak(req, res) {
  try {
    const user = await User.findById(req.user.id);
    const today = new Date();
    const last = user.lastStreakDate ? new Date(user.lastStreakDate) : null;

    const isSameDay =
      last &&
      last.getFullYear() === today.getFullYear() &&
      last.getMonth() === today.getMonth() &&
      last.getDate() === today.getDate();

    if (isSameDay) {
      return res.json({ streakCount: user.streakCount, coins: user.coins, deltaCoins: 0 });
    }

    // Keep count for fun, but award no coins
    let nextCount = 1;
    if (last) {
      const diffDays = Math.floor(
        (today - new Date(last.getFullYear(), last.getMonth(), last.getDate())) / 86400000
      );
      nextCount = diffDays === 1 ? user.streakCount + 1 : 1;
    }

    user.streakCount = nextCount;
    user.lastStreakDate = today;
    await user.save();

    res.json({ streakCount: user.streakCount, coins: user.coins, deltaCoins: 0 });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}


===== FILE: backend\src\controllers\userController.js =====
import User from "../models/User.js";
import { XP_PER_TASK } from "../config/xp.js";
import { COINS_PER_TASK, MILESTONE_BONUSES } from "../config/coins.js";
import { getRankForXp } from "../config/ranks.js";

/** ---------- Helpers to reconcile XP & Coins from learning state ---------- */
function computeXpFromLearning(user) {
  if (!user?.learningSkills?.length) return 0;
  let doneTasks = 0;
  for (const e of user.learningSkills) {
    if (Array.isArray(e.completedTasks)) doneTasks += e.completedTasks.filter(Boolean).length;
  }
  return doneTasks * XP_PER_TASK;
}

function computeCoinsFromLearning(user) {
  let base = 0;
  let milestoneSum = 0;
  for (const e of user.learningSkills) {
    if (!e || !Array.isArray(e.completedTasks)) continue;
    const total = e.completedTasks.length;
    const done  = e.completedTasks.filter(Boolean).length;
    base += done * COINS_PER_TASK;

    const pct = total ? Math.round((done / total) * 100) : 0;
    if (!e.milestones) e.milestones = new Map();
    for (const t of [25,50,75,100]) {
      const k = String(t);
      const already = e.milestones.get(k) || false;
      if (pct >= t && !already) {
        milestoneSum += (MILESTONE_BONUSES[t] || 0);
        e.milestones.set(k, true);
      }
    }
  }
  return { totalCoins: base + milestoneSum };
}

/** ---------- GET /api/users/me ---------- */
export async function getMe(req, res) {
  try {
    const user = await User.findById(req.user.id);
    if (!user) return res.status(404).json({ message: "User not found" });

    const computedXp = computeXpFromLearning(user);
    if (user.xp !== computedXp) user.xp = computedXp;

    const { totalCoins: baseline } = computeCoinsFromLearning(user);
    if (user.coins < baseline) user.coins = baseline;

    await user.save();

    const rank = getRankForXp(user.xp || 0);

    res.json({
      username: user.username,
      isAdmin: user.isAdmin,
      xp: user.xp,
      coins: user.coins,
      createdAt: user.createdAt,
      xpPerTask: XP_PER_TASK,
      rank,
      // NEW
      inventory: user.inventory ?? [],
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}

/** ---------- GET /api/users/leaderboard ---------- */
export async function getLeaderboard(req, res) {
  try {
    const limit  = Math.min(parseInt(req.query.limit ?? "50", 10), 200);
    const offset = Math.max(parseInt(req.query.offset ?? "0", 10), 0);

    const users = await User.find({}, "username xp createdAt")
      .sort({ xp: -1, createdAt: 1 })
      .skip(offset)
      .limit(limit)
      .lean();

    const decorated = users.map((u, i) => ({
      username: u.username,
      xp: u.xp ?? 0,
      rank: getRankForXp(u.xp ?? 0),
      position: offset + i + 1,
    }));

    const me = await User.findById(req.user.id, "xp").lean();
    let myPosition = null;
    if (me) {
      const ahead = await User.countDocuments({ xp: { $gt: me.xp ?? 0 } });
      myPosition = ahead + 1;
    }

    res.json({
      items: decorated,
      limit,
      offset,
      me: myPosition != null ? { position: myPosition, xp: me?.xp ?? 0, rank: getRankForXp(me?.xp ?? 0) } : null,
    });
  } catch {
    res.status(500).json({ message: "Server error" });
  }
}


===== FILE: backend\src\middleware\authMiddleware.js =====
import jwt from "jsonwebtoken";
const JWT_SECRET = process.env.JWT_SECRET || "replace_this_with_env_secret";

export const protect = (req, res, next) => {
  let token;
  if (
    req.headers.authorization &&
    req.headers.authorization.startsWith("Bearer")
  ) {
    token = req.headers.authorization.split(" ")[1];
  }
  if (!token) {
    return res.status(401).json({ message: "Not authorized, no token" });
  }
  try {
    const decoded = jwt.verify(token, JWT_SECRET);
    req.user = { id: decoded.id, isAdmin: decoded.isAdmin };
    next();
  } catch {
    res.status(401).json({ message: "Token invalid" });
  }
};

export const admin = (req, res, next) => {
  if (!req.user || !req.user.isAdmin) {
    return res.status(403).json({ message: "Admin privileges required" });
  }
  next();
};


===== FILE: backend\src\models\Skill.js =====
import mongoose from "mongoose";

const taskSchema = new mongoose.Schema({
  title:   { type: String, required: true },
  content: { type: String, required: true },
});

const skillSchema = new mongoose.Schema(
  {
    name:     { type: String, required: true },
    category: { type: String, required: true },      
    tasks:    { type: [taskSchema], default: [] },
  },
  { timestamps: true }
);

export default mongoose.model("Skill", skillSchema);


===== FILE: backend\src\models\User.js =====
import mongoose from "mongoose";
import bcrypt from "bcrypt";

const decorationSchema = new mongoose.Schema({
  id:    { type: String, required: true },  // client UUID
  itemId:{ type: String, required: true },  // SHOP_ITEMS.id
  xPct:  { type: Number, required: true },  // 0..100
  yPct:  { type: Number, required: true },  // 0..100
}, { _id: false });

const learningSkillSchema = new mongoose.Schema({
  skill: { type: mongoose.Schema.Types.ObjectId, ref: "Skill", required: true },
  completedTasks: { type: [Boolean], default: [] },
  milestones: { type: Map, of: Boolean, default: {} }, // "25","50","75","100"
  startedAt: { type: Date, default: Date.now },
  lastUpdated: { type: Date, default: Date.now },

  // NEW: saved layout for this skill‚Äôs tree
  decorations: { type: [decorationSchema], default: [] },
});

const coinTxnSchema = new mongoose.Schema({
  type: { type: String, enum: ["earn", "spend"], default: "earn" },
  amount: { type: Number, required: true },
  reason: { type: String, required: true },
  skill: { type: mongoose.Schema.Types.ObjectId, ref: "Skill", default: null },
  meta: { type: Object, default: {} },
  createdAt: { type: Date, default: Date.now },
}, { _id: false });

const inventoryItemSchema = new mongoose.Schema({
  itemId: { type: String, required: true },
  qty: { type: Number, default: 1 },
  acquiredAt: { type: Date, default: Date.now },
}, { _id: false });

const userSchema = new mongoose.Schema(
  {
    username: { type: String, required: true, unique: true },
    password: { type: String, required: true },
    isAdmin:  { type: Boolean, default: false },

    learningSkills: [learningSkillSchema],

    xp:    { type: Number, default: 0 },
    coins: { type: Number, default: 0 },
    coinTransactions: { type: [coinTxnSchema], default: [] },

    inventory: { type: [inventoryItemSchema], default: [] },

    streakCount:     { type: Number, default: 0 },
    lastStreakDate:  { type: Date, default: null },
    reflectionWeeks: { type: [String], default: [] },
  },
  { timestamps: true }
);

userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) return next();
  this.password = await bcrypt.hash(this.password, 10);
  next();
});

userSchema.methods.comparePassword = function (candidate) {
  return bcrypt.compare(candidate, this.password);
};

export default mongoose.model("User", userSchema);


===== FILE: backend\src\routes\authRoutes.js =====
import express from "express";
import { register, login } from "../controllers/authController.js";

const router = express.Router();

router.post("/register", register);
router.post("/login", login);

export default router;


===== FILE: backend\src\routes\learningRoutes.js =====
import express from "express";
import {
  startLearning,
  getLearningSkills,
  getLearningSkill,
  toggleTask,
  getDecorations,   // NEW
  saveDecorations,  // NEW
} from "../controllers/learningController.js";
import { protect } from "../middleware/authMiddleware.js";

const router = express.Router();
router.use(protect);

router.get("/", getLearningSkills);
router.get("/:skillId", getLearningSkill);
router.post("/:skillId", startLearning);
router.patch("/:skillId/task/:taskIndex", toggleTask);

// NEW: decorations
router.get("/:skillId/decorations", getDecorations);
router.put("/:skillId/decorations", saveDecorations);

export default router;


===== FILE: backend\src\routes\reflectionsRoutes.js =====
import express from "express";
import { protect } from "../middleware/authMiddleware.js";
import { submitReflection } from "../controllers/reflectionsController.js";

const router = express.Router();
router.use(protect);

router.post("/", submitReflection); // call when a weekly reflection is submitted

export default router;


===== FILE: backend\src\routes\shopRoutes.js =====
// backend/src/routes/shopRoutes.js
import express from "express";
import { protect } from "../middleware/authMiddleware.js";
import { getItems, buyItem } from "../controllers/shopController.js";

const router = express.Router();
router.use(protect);

router.get("/items", getItems);
router.post("/buy/:itemId", buyItem);

export default router;


===== FILE: backend\src\routes\skillsRoutes.js =====
import express from "express";
import {
  getAllSkills,
  getSkillById,
  createSkill,
  updateSkill,
  deleteSkill,
  createCustomSkill, 
} from "../controllers/skillsController.js";
import { protect, admin } from "../middleware/authMiddleware.js";

const router = express.Router();

router.get("/", getAllSkills);


router.post("/custom", protect, createCustomSkill);

router.get("/:id", getSkillById);

router.post("/", protect, admin, createSkill);
router.put("/:id", protect, admin, updateSkill);
router.delete("/:id", protect, admin, deleteSkill);

export default router;


===== FILE: backend\src\routes\streakRoutes.js =====
import express from "express";
import { protect } from "../middleware/authMiddleware.js";
import { tickStreak } from "../controllers/streakController.js";

const router = express.Router();
router.use(protect);

router.post("/tick", tickStreak); // call once after first task completion of the day

export default router;


===== FILE: backend\src\routes\usersRoutes.js =====
import express from "express";
import { protect } from "../middleware/authMiddleware.js";
import { getMe, getLeaderboard } from "../controllers/userController.js";

const router = express.Router();

router.get("/me", protect, getMe);
router.get("/leaderboard", protect, getLeaderboard);

export default router;


===== IMAGE FILE: frontend\public\vite.svg =====

===== FILE: frontend\src\App.jsx =====
import { Routes, Route, useLocation, Navigate } from 'react-router-dom';
import { getToken, getIsAdmin } from './lib/auth';

import UserNavbar from './components/user/UserNavbar';
import AdminNavbar from './components/admin/AdminNavbar';

import LoginPage from './views/user/LoginPage';
import RegisterPage from './views/user/RegisterPage';
import DashboardPage from './views/user/DashboardPage';
import UserSkillsListPage from './views/user/UserSkillsListPage';
import UserSkillDetailPage from './views/user/UserSkillDetailPage';
import DashboardSkillDetailPage from './views/user/DashboardSkillDetailPage';
import SkillForestPage from './views/user/SkillForestPage';
import CreateCustomSkillPage from './views/user/CreateCustomSkillPage';
import AdminSkillsListPage from './views/admin/AdminSkillsListPage';
import AdminCreateSkillPage from './views/admin/AdminCreateSkillPage';
import AdminSkillDetailPage from './views/admin/AdminSkillDetailPage';

import ProfilePage from './views/user/ProfilePage';
import LeaderboardPage from './views/user/LeaderboardPage';
import ShopPage from './views/user/ShopPage'; // NEW

export default function App() {
  const { pathname } = useLocation();
  const token      = getToken();
  const isAdmin    = getIsAdmin();
  const isLoggedIn = !!token;

  // Routes for regular users
  const isUserRoute = [
    '/login',
    '/register',
    '/dashboard',
    '/skills',
    '/forest',
    '/custom-skill',
    '/profile',
    '/leaderboard',
    '/shop', // NEW
  ].some((p) => pathname.startsWith(p));

  return (
    <div className="flex flex-col h-screen bg-base-200 text-base-content">
      {isLoggedIn && isAdmin ? <AdminNavbar /> : <UserNavbar />}

      <div className="flex-1 overflow-auto">
        {isUserRoute ? (
          <Routes>
            {/* Auth */}
            <Route
              path="/login"
              element={
                isLoggedIn ? (
                  <Navigate to={isAdmin ? '/' : '/dashboard'} replace />
                ) : (
                  <LoginPage />
                )
              }
            />
            <Route
              path="/register"
              element={
                isLoggedIn ? (
                  <Navigate to={isAdmin ? '/' : '/dashboard'} replace />
                ) : (
                  <RegisterPage />
                )
              }
            />

            {/* User-only pages */}
            <Route path="/dashboard" element={isLoggedIn ? <DashboardPage /> : <Navigate to="/login" replace />} />
            <Route path="/dashboard/:id" element={isLoggedIn ? <DashboardSkillDetailPage /> : <Navigate to="/login" replace />} />

            <Route path="/skills" element={isLoggedIn ? <UserSkillsListPage /> : <Navigate to="/login" replace />} />
            <Route path="/skills/:id" element={isLoggedIn ? <UserSkillDetailPage /> : <Navigate to="/login" replace />} />

            <Route path="/forest" element={isLoggedIn ? <SkillForestPage /> : <Navigate to="/login" replace />} />
            <Route path="/custom-skill" element={isLoggedIn ? <CreateCustomSkillPage /> : <Navigate to="/login" replace />} />

            <Route path="/profile" element={isLoggedIn ? <ProfilePage /> : <Navigate to="/login" replace />} />
            <Route path="/leaderboard" element={isLoggedIn ? <LeaderboardPage /> : <Navigate to="/login" replace />} />

            {/* NEW: Shop */}
            <Route path="/shop" element={isLoggedIn ? <ShopPage /> : <Navigate to="/login" replace />} />
          </Routes>
        ) : (
          // Admin area
          <main className="max-w-5xl mx-auto px-4 py-10">
            <Routes>
              <Route
                path="/"
                element={
                  isLoggedIn && isAdmin ? (
                    <AdminSkillsListPage />
                  ) : (
                    <Navigate to="/dashboard" replace />
                  )
                }
              />
              <Route
                path="/create-skill"
                element={
                  isLoggedIn && isAdmin ? (
                    <AdminCreateSkillPage />
                  ) : (
                    <Navigate to="/dashboard" replace />
                  )
                }
              />
              <Route
                path="/skill/:id"
                element={
                  isLoggedIn && isAdmin ? (
                    <AdminSkillDetailPage />
                  ) : (
                    <Navigate to="/dashboard" replace />
                  )
                }
              />
            </Routes>
          </main>
        )}
      </div>
    </div>
  );
}


===== FILE: frontend\src\index.css =====
@tailwind base;
@tailwind components;
@tailwind utilities;

/* fill whole viewport */
html, body, #root {
  height: 100%;
  margin: 0;
}

/* background now uses your theme‚Äôs neutral color */
body {
  @apply font-sans bg-neutral text-base-content;
}

/* keep softer corners since Codecademy uses rounded cards */
.card,
.btn {
  @apply rounded-lg border-none;
}

/* ================================
   Whiter drop-shadows in dark theme
   ================================ */
[data-theme="forest"] .shadow-sm {
  box-shadow: 0 1px 2px rgba(255,255,255,0.05) !important;
}

[data-theme="forest"] .shadow {
  box-shadow: 0 1px 3px rgba(255,255,255,0.1), 0 1px 2px rgba(255,255,255,0.06) !important;
}

[data-theme="forest"] .shadow-md {
  box-shadow: 0 4px 6px rgba(255,255,255,0.1), 0 2px 4px rgba(255,255,255,0.05) !important;
}

[data-theme="forest"] .shadow-lg {
  box-shadow: 0 10px 15px rgba(255,255,255,0.1), 0 4px 6px rgba(255,255,255,0.05) !important;
}

[data-theme="forest"] .shadow-xl {
  box-shadow: 0 20px 25px rgba(255,255,255,0.1), 0 10px 10px rgba(255,255,255,0.05) !important;
}

[data-theme="forest"] .shadow-2xl {
  box-shadow: 0 25px 50px rgba(255,255,255,0.1) !important;
}


===== FILE: frontend\src\main.jsx =====
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './index.css';
import { Toaster } from 'react-hot-toast';

import { BrowserRouter } from 'react-router-dom';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
      <Toaster />
    </BrowserRouter>
  </React.StrictMode>
);


===== IMAGE FILE: frontend\public\forest\forest-bg.png =====

===== IMAGE FILE: frontend\public\shop\bird-house.png =====

===== IMAGE FILE: frontend\public\shop\fairy-lights.png =====

===== IMAGE FILE: frontend\public\shop\ground-rocks.png =====

===== IMAGE FILE: frontend\public\shop\leaf-banner.png =====

===== IMAGE FILE: frontend\public\shop\mushroom-pack.png =====

===== IMAGE FILE: frontend\public\shop\tree-plaque.png =====

===== IMAGE FILE: frontend\public\shop\tree-ribbon.png =====

===== IMAGE FILE: frontend\public\shop\wind-chime.png =====

===== IMAGE FILE: frontend\public\trees\full-tree.png =====

===== IMAGE FILE: frontend\public\trees\leafy-tree.png =====

===== IMAGE FILE: frontend\public\trees\seed.png =====

===== IMAGE FILE: frontend\public\trees\small-plant.png =====

===== IMAGE FILE: frontend\public\trees\sprout.png =====

===== IMAGE FILE: frontend\public\trees\young-tree.png =====

===== FILE: frontend\src\lib\auth.js =====

export function saveToken(token) {
  localStorage.setItem("skilltree_token", token);
}
export function getToken() {
  return localStorage.getItem("skilltree_token");
}
export function clearToken() {
  localStorage.removeItem("skilltree_token");
}

export function saveIsAdmin(flag) {
  localStorage.setItem("skilltree_isAdmin", String(flag));
}
export function getIsAdmin() {
  return localStorage.getItem("skilltree_isAdmin") === "true";
}
export function clearIsAdmin() {
  localStorage.removeItem("skilltree_isAdmin");
}


export function clearAuth() {
  clearToken();
  clearIsAdmin();
}


===== FILE: frontend\src\lib\axios.js =====
import axios from "axios";
import { getToken, clearAuth } from "./auth";

const BASE_URL =
  import.meta.env.MODE === "development"
    ? "http://localhost:5001/api"
    : "/api";

const api = axios.create({ baseURL: BASE_URL });

api.interceptors.request.use((config) => {
  const token = getToken();
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});


api.interceptors.response.use(
  (res) => res,
  (error) => {
    const status = error.response?.status;
    const reqUrl = error.config?.url || "";

    if (
      status === 401 &&
      !reqUrl.endsWith("/auth/login") &&
      !reqUrl.endsWith("/auth/register")
    ) {
      clearAuth();
      window.location.href = "/login";
    }
    return Promise.reject(error);
  }
);

export default api;


===== FILE: frontend\src\lib\categories.js =====
export const CATEGORIES = [
  "Programming",
  "Web Development",
  "Miscellaneous",
  "Sports"
];


===== FILE: frontend\src\lib\dashboard.js =====
// frontend/src/lib/dashboard.js
export function getLearning() {
  return JSON.parse(localStorage.getItem("skilltree_learning") || "[]");
}

export function addLearning(skillId) {
  const list = getLearning();
  if (!list.includes(skillId)) {
    list.push(skillId);
    localStorage.setItem("skilltree_learning", JSON.stringify(list));
  }
}


===== FILE: frontend\src\lib\utils.js =====
export function formatDate(date) {
  return date.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric",
    year: "numeric",
  });
}

===== FILE: frontend\src\components\admin\AdminNavbar.jsx =====
import { Link, useNavigate } from "react-router-dom";
import { SunIcon, MoonIcon, LogOutIcon } from "lucide-react";
import { useState, useEffect } from "react";
import { clearAuth } from "../../lib/auth";

export default function AdminNavbar() {
  const [forestMode, setForestMode] = useState(
    localStorage.getItem("theme") === "forest"
  );
  const navigate = useNavigate();

  useEffect(() => {
    const theme = forestMode ? "forest" : "light-forest";
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
  }, [forestMode]);

  const logout = () => {
    clearAuth();
    navigate("/login");
  };

  return (
    <nav className="navbar bg-base-100 shadow-md">
      <div className="container mx-auto flex items-center justify-between px-4">
        <Link to="/" className="text-2xl font-bold">
          SkillTree&nbsp;<span className="text-primary">Admin</span>
        </Link>

        <div className="flex items-center space-x-2">
          <button
            aria-label="Toggle theme"
            className="btn btn-ghost btn-circle btn-sm"
            onClick={() => setForestMode(!forestMode)}
          >
            {forestMode ? (
              <SunIcon className="h-5 w-5" />
            ) : (
              <MoonIcon className="h-5 w-5" />
            )}
          </button>

          <button
            onClick={logout}
            className="btn btn-primary btn-sm flex items-center gap-1"
          >
            <LogOutIcon className="h-4 w-4" />
            <span>Log Out</span>
          </button>
        </div>
      </div>
    </nav>
  );
}


===== FILE: frontend\src\components\admin\AdminSkillCard.jsx =====
import { Link } from "react-router-dom";

export default function AdminSkillCard({ skill }) {
  return (
    <Link
      to={`/skill/${skill._id}`}
      className="
        card bg-neutral shadow hover:shadow-lg transition
        border border-black /* static black */"
    >
      <div className="card-body">
        <div className="flex items-start justify-between gap-3">
          <h3 className="card-title text-lg flex-1 break-words">
            {skill.name}
          </h3>
          <span
            className="badge badge-primary px-4 py-[6px] text-xs font-semibold whitespace-nowrap overflow-hidden text-ellipsis max-w-[10rem]"
            title={skill.category}
          >
            {skill.category}
          </span>
        </div>
        <p className="text-sm opacity-70 mt-1">
          {skill.tasks.length} task{skill.tasks.length !== 1 && "s"}
        </p>
      </div>
    </Link>
  );
}


===== FILE: frontend\src\components\user\RankBadge.jsx =====
// frontend/src/components/user/RankBadge.jsx
import {
  AwardIcon,
  MedalIcon,
  CrownIcon,
  GemIcon,
  StarIcon,
  SparklesIcon, // NEW for Mythic
} from "lucide-react";

/**
 * Usage:
 *  - <RankBadge rank={rank} />                          // small pill (default)
 *  - <RankBadge rank={rank} variant="circle" size="xl" showLabelBelow />  // big circular emblem
 */
const STYLES = {
  unranked: { bg: "bg-base-200", text: "text-base-content", ring: "ring-base-300", Icon: StarIcon },
  bronze:   { bg: "bg-amber-200", text: "text-amber-900",   ring: "ring-amber-300", Icon: MedalIcon },
  silver:   { bg: "bg-gray-200",  text: "text-gray-900",    ring: "ring-gray-300",  Icon: AwardIcon },
  gold:     { bg: "bg-yellow-200",text: "text-yellow-900",  ring: "ring-yellow-300",Icon: CrownIcon },
  diamond:  { bg: "bg-cyan-200",  text: "text-cyan-900",    ring: "ring-cyan-300",  Icon: GemIcon },
  mythic:   { bg: "bg-purple-200",text: "text-purple-900",  ring: "ring-purple-300",Icon: SparklesIcon }, // fixed
};

const SIZE = {
  sm: { box: "w-16 h-16", icon: "h-6 w-6", label: "text-xs" },
  md: { box: "w-24 h-24", icon: "h-10 w-10", label: "text-sm" },
  lg: { box: "w-32 h-32", icon: "h-14 w-14", label: "text-base" },
  xl: { box: "w-40 h-40", icon: "h-16 w-16", label: "text-lg" },
};

export default function RankBadge({
  rank,
  variant = "pill",       // "pill" | "circle"
  size = "md",            // sm | md | lg | xl
  showLabelBelow = false,
}) {
  const key = rank?.current?.key || "unranked";
  const name = rank?.current?.name || "Unranked";
  const { bg, text, ring, Icon } = STYLES[key] || STYLES.unranked;

  if (variant === "circle") {
    const s = SIZE[size] || SIZE.md;
    return (
      <div className="flex flex-col items-center">
        <div className={["inline-flex items-center justify-center rounded-full shadow","ring-4 ring-offset-2",bg,text,ring,s.box].join(" ")}>
          <Icon className={s.icon} />
        </div>
        {showLabelBelow && (
          <div className={`mt-2 font-semibold ${s.label} ${text}`}>{name}</div>
        )}
      </div>
    );
  }

  // compact pill
  return (
    <span className={`badge ${bg} ${text} px-4 py-3 text-sm gap-2 flex items-center`}>
      <Icon className="h-4 w-4" />
      <span>{name}</span>
    </span>
  );
}


===== FILE: frontend\src\components\user\Sidebar.jsx =====
import { Link, useNavigate, useLocation } from "react-router-dom";
import { clearAuth } from "../../lib/auth";
import { CATEGORIES } from "../../lib/categories";
import {
  LayersIcon,
  CircleIcon,
  CheckCircle2Icon,
  TagIcon,
  UserIcon,
  LogOutIcon,
} from "lucide-react";

export default function Sidebar({ learning }) {
  const navigate = useNavigate();
  const { pathname, search } = useLocation();
  const qs = new URLSearchParams(search);

  const completed = learning.filter(
    (s) =>
      s.tasks.length &&
      s.completedTasks.filter(Boolean).length === s.tasks.length
  ).length;
  const inProgress = learning.length - completed;

  const active = (cond) =>
    cond ? "active bg-primary text-primary-content" : "";

  const logout = () => {
    clearAuth();
    navigate("/login");
  };

  return (
    <div className="container mx-auto px-4 ">
      <aside
        className="
          fixed top-20
          w-64 h-100
          bg-base-100 border border-primary
          shadow-lg flex flex-col z-30
        "
      >
        <ul className="menu menu-vertical px-4 py-6 flex-1 overflow-y-auto">
          <li className="menu-title"><span>Main</span></li>
          <li className={active(pathname === "/dashboard" && qs.get("filter") === "all")}>
            <Link to="/dashboard?filter=all" className="flex items-center gap-2">
              <LayersIcon className="h-5 w-5" />
              <span>All Skills</span>
            </Link>
          </li>

          <li className="menu-title mt-4"><span>My Progress</span></li>
          <li className={active(!qs.get("filter") || qs.get("filter") === "in")}>
            <Link to="/dashboard" className="flex items-center gap-2">
              <CircleIcon className="h-5 w-5" />
              <span>In Progress</span>
              <span className="badge badge-info ml-auto">{inProgress}</span>
            </Link>
          </li>
          <li className={active(qs.get("filter") === "completed")}>
            <Link to="/dashboard?filter=completed" className="flex items-center gap-2">
              <CheckCircle2Icon className="h-5 w-5" />
              <span>Completed</span>
              <span className="badge badge-success ml-auto">{completed}</span>
            </Link>
          </li>

          <li className="menu-title mt-4"><span>Categories</span></li>
          {CATEGORIES.map((c) => (
            <li key={c} className={active(qs.get("category") === c)}>
              <Link
                to={`/dashboard?filter=all&category=${encodeURIComponent(c)}`}
                className="flex items-center gap-2"
              >
                <TagIcon className="h-5 w-5" />
                <span>{c}</span>
              </Link>
            </li>
          ))}
        </ul>

        <div className="px-4 py-4 border-t border-base-300 space-y-2">
          <Link
            to="/profile"
            className="btn btn-ghost btn-sm w-full justify-start flex items-center gap-2"
          >
            <UserIcon className="h-5 w-5" />
            Profile
          </Link>
          <button
            onClick={logout}
            className="btn btn-ghost btn-sm w-full justify-start flex items-center gap-2"
          >
            <LogOutIcon className="h-5 w-5" />
            Log Out
          </button>
        </div>
      </aside>
    </div>
  );
}


===== FILE: frontend\src\components\user\SkillCard.jsx =====
import { useNavigate } from "react-router-dom";
import {
  TagIcon,
  ClipboardListIcon,
  ArrowRightCircleIcon,
} from "lucide-react";
import SkillProgressBar from "./SkillProgressBar";

export default function SkillCard({ skill, to, progress }) {
  const navigate = useNavigate();
  return (
    <div
      onClick={() => navigate(to)}
      className="
        bg-base-100 p-5 shadow hover:shadow-lg
        transition cursor-pointer border border-primary
      "
    >
      <div className="flex items-center justify-between mb-2">
        <h2 className="text-xl font-semibold flex-1">{skill.name}</h2>
        <ArrowRightCircleIcon className="h-6 w-6 text-secondary" />
      </div>

      <div className="flex items-center text-sm opacity-75 mb-4 space-x-4">
        <span className="flex items-center space-x-1">
          <TagIcon className="h-4 w-4" />
          <span>{skill.category}</span>
        </span>
        <span className="flex items-center space-x-1">
          <ClipboardListIcon className="h-4 w-4" />
          <span>{skill.tasks.length} task{skill.tasks.length !== 1 && "s"}</span>
        </span>
      </div>

      {progress !== undefined && (
        <>
          <SkillProgressBar percent={progress} />
          <p className="text-xs opacity-70 mt-1 flex items-center space-x-1">
            <span>{progress}%</span>
            <span>completed</span>
          </p>
        </>
      )}
    </div>
  );
}


===== FILE: frontend\src\components\user\SkillProgressBar.jsx =====

import React from "react";

export default function SkillProgressBar({ percent }) {
  return (
    <div className="w-full bg-base-200 h-5 overflow-hidden mt-2">
      <div
        className="h-full bg-primary transition-all"
        style={{ width: `${percent}%` }}
      />
    </div>
  );
}


===== FILE: frontend\src\components\user\UserNavbar.jsx =====
import { Link, useNavigate, useLocation } from "react-router-dom";
import {
  SunIcon,
  MoonIcon,
  HomeIcon,
  BookOpenIcon,
  GridIcon,
  TreesIcon,
  PlusCircleIcon,
  TrophyIcon,
  CoinsIcon,
  AwardIcon,
  StoreIcon,
} from "lucide-react";
import { useState, useEffect } from "react";
import { clearAuth, getToken, getIsAdmin } from "../../lib/auth";
import api from "../../lib/axios";

export default function UserNavbar() {
  const navigate = useNavigate();
  const { pathname } = useLocation();
  const loggedIn = !!getToken();
  const isAdmin = getIsAdmin();

  const [forestMode, setForestMode] = useState(
    localStorage.getItem("theme") === "forest"
  );
  const [xp, setXp] = useState(null);
  const [coins, setCoins] = useState(null);

  useEffect(() => {
    const theme = forestMode ? "forest" : "light-forest";
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
  }, [forestMode]);

  const fetchTotals = async () => {
    if (!loggedIn) {
      setXp(null);
      setCoins(null);
      return;
    }
    try {
      const { data } = await api.get("/users/me");
      setXp(typeof data?.xp === "number" ? data.xp : 0);
      setCoins(typeof data?.coins === "number" ? data.coins : 0);
    } catch { /* no-op */ }
  };

  useEffect(() => { fetchTotals(); }, [pathname, loggedIn]);

  useEffect(() => {
    const xpHandler = (e) => { if (typeof e?.detail?.xp === "number") setXp(e.detail.xp); };
    const coinHandler = (e) => { if (typeof e?.detail?.coins === "number") setCoins(e.detail.coins); };
    window.addEventListener("xp:update", xpHandler);
    window.addEventListener("coins:update", coinHandler);
    return () => {
      window.removeEventListener("xp:update", xpHandler);
      window.removeEventListener("coins:update", coinHandler);
    };
  }, []);

  const logout = () => { clearAuth(); navigate("/login"); };

  const isActive = (p) => pathname === p || (p !== "/dashboard" && pathname.startsWith(p));

  return (
    <nav className="bg-secondary-content shadow-md">
      <div className="container mx-auto flex justify-between items-center px-4 py-3">
        <Link
          to={loggedIn ? (isAdmin ? "/" : "/dashboard") : "/"}
          className="flex items-center text-xl font-bold space-x-2"
        >
          <GridIcon className="h-6 w-6 text-primary" />
          <span>SkillTree</span>
        </Link>

        <div className="flex items-center space-x-2 sm:space-x-4">
          {loggedIn && (
            <>
              <span className="badge badge-primary px-3 py-2 text-xs sm:text-sm flex items-center gap-1" title="Total XP">
                <TrophyIcon className="h-3.5 w-3.5" />
                <span>XP {xp ?? "‚Äî"}</span>
              </span>
              <span className="badge bg-amber-200 text-amber-900 px-3 py-2 text-xs sm:text-sm flex items-center gap-1" title="Total Coins">
                <CoinsIcon className="h-3.5 w-3.5" />
                <span>{coins ?? "‚Äî"} coins</span>
              </span>
            </>
          )}

          <button
            aria-label="Toggle theme"
            className="btn btn-ghost btn-circle btn-sm"
            onClick={() => setForestMode(!forestMode)}
          >
            {forestMode ? <SunIcon className="h-5 w-5" /> : <MoonIcon className="h-5 w-5" />}
          </button>

          {loggedIn ? (
            <>
              <Link to="/dashboard" className={`btn btn-ghost btn-sm flex items-center space-x-1 ${isActive("/dashboard") ? "btn-active" : ""}`}>
                <HomeIcon className="h-4 w-4" />
                <span>Dashboard</span>
              </Link>

              <Link to="/skills" className={`btn btn-ghost btn-sm flex items-center space-x-1 ${isActive("/skills") ? "btn-active" : ""}`}>
                <BookOpenIcon className="h-4 w-4" />
                <span>Skills</span>
              </Link>

              <Link to="/custom-skill" className={`btn btn-ghost btn-sm flex items-center space-x-1 ${isActive("/custom-skill") ? "btn-active" : ""}`}>
                <PlusCircleIcon className="h-4 w-4" />
                <span>Create Custom Skill</span>
              </Link>

              <Link to="/forest" className={`btn btn-ghost btn-sm flex items-center space-x-1 ${isActive("/forest") ? "btn-active" : ""}`}>
                <TreesIcon className="h-4 w-4" />
                <span>Forest View</span>
              </Link>

              {/* NEW: Shop */}
              <Link to="/shop" className={`btn btn-ghost btn-sm flex items-center space-x-1 ${isActive("/shop") ? "btn-active" : ""}`}>
                <StoreIcon className="h-4 w-4" />
                <span>Shop</span>
              </Link>

              <Link to="/leaderboard" className={`btn btn-ghost btn-sm flex items-center space-x-1 ${isActive("/leaderboard") ? "btn-active" : ""}`}>
                <AwardIcon className="h-4 w-4" />
                <span>Leaderboard</span>
              </Link>

              <button onClick={logout} className="btn btn-primary btn-sm flex items-center space-x-1">
                <MoonIcon className="h-4 w-4 rotate-90" />
                <span>Log Out</span>
              </button>
            </>
          ) : (
            <>
              <Link to="/login" className="btn btn-primary btn-sm">Log In</Link>
              <Link to="/register" className="btn btn-primary btn-sm">Sign Up</Link>
            </>
          )}
        </div>
      </div>
    </nav>
  );
}


===== FILE: frontend\src\views\admin\AdminCreateSkillPage.jsx =====
import { useState } from "react";
import { useNavigate, Link } from "react-router-dom";
import toast from "react-hot-toast";
import { PlusIcon, MinusIcon } from "lucide-react";
import api from "../../lib/axios";
import { CATEGORIES } from "../../lib/categories";

export default function AdminCreateSkillPage() {
  const [name, setName] = useState("");
  const [category, setCategory] = useState(CATEGORIES[0]);
  const [tasks, setTasks] = useState([{ title: "", content: "" }]);
  const [saving, setSaving] = useState(false);
  const navigate = useNavigate();

  const addTask = () =>
    setTasks((prev) => [...prev, { title: "", content: "" }]);
  const removeTask = (idx) =>
    setTasks((prev) => prev.filter((_, i) => i !== idx));
  const updateTask = (idx, key, val) =>
    setTasks((prev) =>
      prev.map((t, i) => (i === idx ? { ...t, [key]: val } : t))
    );

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!name.trim()) return toast.error("Name required");
    if (tasks.some((t) => !t.title.trim() || !t.content.trim()))
      return toast.error("All tasks need title & content");

    setSaving(true);
    try {
      await api.post("/skills", { name, category, tasks });
      toast.success("Skill created");
      navigate("/");
    } catch {
      toast.error("Creation failed");
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="max-w-3xl mx-auto">
      <Link to="/" className="btn btn-ghost mb-6">‚Üê Back</Link>

      <div className="card bg-base-100 shadow-xl">
        <div className="card-body space-y-8">
          <h2 className="card-title text-2xl">Create Skill</h2>

          <form onSubmit={handleSubmit} className="space-y-8">
            <div>
              <label className="label">Skill Name</label>
              <input
                className="input input-bordered w-full"
                value={name}
                onChange={(e) => setName(e.target.value)}
              />
            </div>

            <div>
              <label className="label">Category</label>
              <select
                className="select select-bordered w-full"
                value={category}
                onChange={(e) => setCategory(e.target.value)}
              >
                {CATEGORIES.map((c) => (
                  <option key={c} value={c}>
                    {c}
                  </option>
                ))}
              </select>
            </div>

            <div className="space-y-4">
              <label className="label">Tasks</label>
              {tasks.map((t, i) => (
                <div key={i} className="space-y-2">
                  <input
                    className="input input-bordered w-full"
                    placeholder="Task title"
                    value={t.title}
                    onChange={(e) => updateTask(i, "title", e.target.value)}
                  />
                  <textarea
                    className="textarea textarea-bordered w-full min-h-[6rem]"
                    placeholder="Task details"
                    value={t.content}
                    onChange={(e) =>
                      updateTask(i, "content", e.target.value)
                    }
                  />
                  <button
                    type="button"
                    className="btn btn-outline btn-error btn-xs"
                    onClick={() => removeTask(i)}
                  >
                    Remove task
                  </button>
                </div>
              ))}

              <button
                type="button"
                className="btn btn-outline btn-secondary"
                onClick={addTask}
              >
                <PlusIcon className="h-5 w-5 mr-2" />
                Add Task
              </button>
            </div>

            <div className="text-right">
              <button
                type="submit"
                className="btn btn-primary px-8"
                disabled={saving}
              >
                {saving ? "Saving‚Ä¶" : "Create Skill"}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\admin\AdminSkillDetailPage.jsx =====
import { useState, useEffect } from "react";
import { useParams, useNavigate, Link } from "react-router-dom";
import toast from "react-hot-toast";
import api from "../../lib/axios";
import { PlusIcon } from "lucide-react";
import { CATEGORIES } from "../../lib/categories";

export default function AdminSkillDetailPage() {
  const { id } = useParams();
  const navigate = useNavigate();
  const [skill, setSkill] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    api
      .get(`/skills/${id}`)
      .then((res) => setSkill(res.data))
      .catch(() => toast.error("Could not load skill"))
      .finally(() => setLoading(false));
  }, [id]);

  const addTask = () =>
    setSkill((p) => ({ ...p, tasks: [...p.tasks, { title: "", content: "" }] }));
  const removeTask = (idx) =>
    setSkill((p) => ({ ...p, tasks: p.tasks.filter((_, i) => i !== idx) }));
  const updateTask = (idx, key, val) =>
    setSkill((p) => ({
      ...p,
      tasks: p.tasks.map((t, i) => (i === idx ? { ...t, [key]: val } : t)),
    }));

  const handleSave = async () => {
    if (!skill.name.trim()) return toast.error("Name required");
    if (skill.tasks.some((t) => !t.title.trim() || !t.content.trim()))
      return toast.error("All tasks need title & content");

    setSaving(true);
    try {
      await api.put(`/skills/${id}`, {
        name: skill.name,
        category: skill.category,
        tasks: skill.tasks,
      });
      toast.success("Skill updated");
      navigate("/");
    } catch {
      toast.error("Update failed");
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm("Delete this skill?")) return;
    try {
      await api.delete(`/skills/${id}`);
      toast.success("Skill deleted");
      navigate("/");
    } catch {
      toast.error("Deletion failed");
    }
  };

  if (loading)
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-lg"></span>
      </div>
    );
  if (!skill) return <p className="text-center py-20">Skill not found.</p>;

  return (
    <div className="max-w-3xl mx-auto">
      <div className="flex justify-between items-center mb-6">
        <Link to="/" className="btn btn-ghost">
          ‚Üê Back
        </Link>
        <button
          onClick={handleDelete}
          className="btn btn-outline btn-error btn-sm"
        >
          Delete Skill
        </button>
      </div>

      <div className="card bg-base-100 shadow-xl">
        <div className="card-body space-y-8">
          <div>
            <label className="label">Skill Name</label>
            <input
              className="input input-bordered w-full"
              value={skill.name}
              onChange={(e) =>
                setSkill({ ...skill, name: e.target.value })
              }
            />
          </div>

          <div>
            <label className="label">Category</label>
            <select
              className="select select-bordered w-full"
              value={skill.category}
              onChange={(e) =>
                setSkill({ ...skill, category: e.target.value })
              }
            >
              {CATEGORIES.map((c) => (
                <option key={c}>{c}</option>
              ))}
            </select>
          </div>

          <div className="space-y-6">
            <h3 className="text-lg font-semibold">Tasks</h3>

            {skill.tasks.map((t, i) => (
              <div
                key={i}
                className="space-y-2 border-b pb-4 last:border-none"
              >
                <input
                  className="input input-bordered w-full"
                  value={t.title}
                  onChange={(e) => updateTask(i, "title", e.target.value)}
                  placeholder="Title"
                />
                <textarea
                  className="textarea textarea-bordered w-full min-h-[6rem]"
                  value={t.content}
                  onChange={(e) =>
                    updateTask(i, "content", e.target.value)
                  }
                  placeholder="Content"
                />
                <button
                  type="button"
                  className="btn btn-outline btn-error btn-xs"
                  onClick={() => removeTask(i)}
                >
                  Remove task
                </button>
              </div>
            ))}

            <button
              type="button"
              className="btn btn-outline btn-secondary"
              onClick={addTask}
            >
              <PlusIcon className="h-5 w-5 mr-2" /> Add Task
            </button>
          </div>

          <div className="text-right pt-2">
            <button
              onClick={handleSave}
              className="btn btn-primary px-8"
              disabled={saving}
            >
              {saving ? "Saving‚Ä¶" : "Save Changes"}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\admin\AdminSkillsListPage.jsx =====
import { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import AdminSkillCard from "../../components/admin/AdminSkillCard";

export default function AdminSkillsListPage() {
  const [skills, setSkills] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    api
      .get("/skills")
      .then((res) => setSkills(res.data))
      .catch(() => toast.error("Could not load skills"))
      .finally(() => setLoading(false));
  }, []);

  if (loading) {
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-lg"></span>
      </div>
    );
  }

  return (
    <section>
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold">Skills</h1>
        <Link to="/create-skill" className="btn btn-primary btn-sm">
          + Add Skill
        </Link>
      </div>

      {skills.length === 0 ? (
        <p className="text-center opacity-70 py-16">No skills yet.</p>
      ) : (
        <div className="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {skills.map((s) => (
            <AdminSkillCard key={s._id} skill={s} />
          ))}
        </div>
      )}
    </section>
  );
}


===== FILE: frontend\src\views\user\CreateCustomSkillPage.jsx =====
import { useState } from "react";
import { useNavigate, Link } from "react-router-dom";
import toast from "react-hot-toast";
import { PlusIcon } from "lucide-react";
import api from "../../lib/axios";
import { CATEGORIES } from "../../lib/categories";

export default function CreateCustomSkillPage() {
  const [name, setName] = useState("");
  const [category, setCategory] = useState(CATEGORIES[0]);
  const [tasks, setTasks] = useState([{ title: "", content: "" }]);
  const [saving, setSaving] = useState(false);
  const navigate = useNavigate();

  const addTask = () => setTasks((prev) => [...prev, { title: "", content: "" }]);
  const removeTask = (idx) => setTasks((prev) => prev.filter((_, i) => i !== idx));
  const updateTask = (idx, key, val) =>
    setTasks((prev) => prev.map((t, i) => (i === idx ? { ...t, [key]: val } : t)));

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!name.trim()) return toast.error("Name required");
    if (tasks.some((t) => !t.title.trim() || !t.content.trim()))
      return toast.error("All tasks need title & content");

    setSaving(true);
    try {
      await api.post("/skills/custom", { name, category, tasks });
      toast.success("Custom skill created");
      navigate("/skills");
    } catch {
      toast.error("Creation failed");
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="max-w-3xl mx-auto">
      <Link to="/skills" className="btn btn-ghost mb-6">‚Üê Back</Link>

      <div className="card bg-base-100 shadow-xl">
        <div className="card-body space-y-8">
          <h2 className="card-title text-2xl">Create Custom Skill</h2>
          <p className="text-sm opacity-70">
            Your skill will be saved with <strong>(Custom)</strong> in the title.
          </p>

          <form onSubmit={handleSubmit} className="space-y-8">
            <div>
              <label className="label">Skill Name</label>
              <input
                className="input input-bordered w-full"
                value={name}
                onChange={(e) => setName(e.target.value)}
                placeholder="e.g. Pixel Art Basics"
              />
            </div>

            <div>
              <label className="label">Category</label>
              <select
                className="select select-bordered w-full"
                value={category}
                onChange={(e) => setCategory(e.target.value)}
              >
                {CATEGORIES.map((c) => (
                  <option key={c} value={c}>{c}</option>
                ))}
              </select>
            </div>

            <div className="space-y-4">
              <label className="label">Tasks</label>
              {tasks.map((t, i) => (
                <div key={i} className="space-y-2">
                  <input
                    className="input input-bordered w-full"
                    placeholder="Task title"
                    value={t.title}
                    onChange={(e) => updateTask(i, "title", e.target.value)}
                  />
                  <textarea
                    className="textarea textarea-bordered w-full min-h-[6rem]"
                    placeholder="Task details"
                    value={t.content}
                    onChange={(e) => updateTask(i, "content", e.target.value)}
                  />
                  <button
                    type="button"
                    className="btn btn-outline btn-error btn-xs"
                    onClick={() => removeTask(i)}
                  >
                    Remove task
                  </button>
                </div>
              ))}

              <button
                type="button"
                className="btn btn-outline btn-secondary"
                onClick={addTask}
              >
                <PlusIcon className="h-5 w-5 mr-2" />
                Add Task
              </button>
            </div>

            <div className="text-right">
              <button type="submit" className="btn btn-primary px-8" disabled={saving}>
                {saving ? "Saving‚Ä¶" : "Create Custom Skill"}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\DashboardPage.jsx =====
// frontend/src/views/user/DashboardPage.jsx
import { useEffect, useState } from "react";
import { Link, useLocation } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import SkillCard from "../../components/user/SkillCard";
import Sidebar from "../../components/user/Sidebar";

export default function DashboardPage() {
  const [learning, setLearning] = useState([]);
  const [loading, setLoading]   = useState(true);

  const { search } = useLocation();
  const params = new URLSearchParams(search);
  const filter = params.get("filter");
  const category = params.get("category");

  useEffect(() => {
    api.get("/learning")
      .then((res) => setLearning(res.data))
      .catch(() => toast.error("Could not load your dashboard"))
      .finally(() => setLoading(false));
  }, []);

  if (loading) {
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-xl" />
      </div>
    );
  }

  if (!learning.length) {
    return (
      <div className="min-h-screen p-6 flex flex-col items-center justify-center bg-neutral">
        <p className="mb-4">You haven‚Äôt started any skills yet.</p>
        <Link to="/skills" className="btn btn-primary btn-sm">
          Browse Skills
        </Link>
      </div>
    );
  }

  // Start with full list
  let displayed = [...learning];

  // Category filter
  if (category) {
    displayed = displayed.filter((s) => s.category === category);
  }

  // Filter type
  if (filter === "completed") {
    displayed = displayed.filter(
      (s) =>
        s.tasks.length > 0 &&
        s.completedTasks.filter(Boolean).length === s.tasks.length
    );
  } else if (filter === "all") {
    // show everything
  } else {
    // default = in-progress
    displayed = displayed.filter(
      (s) =>
        !(
          s.tasks.length > 0 &&
          s.completedTasks.filter(Boolean).length === s.tasks.length
        )
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-neutral via-neutral to-neutral pb-6">
      {/* Fixed, container-aligned sidebar */}
      <Sidebar learning={learning} />

      {/* Main content inside the SAME container width as navbar */}
      <div className="container mx-auto px-4">
        {/* Reserve space for the fixed sidebar inside the container */}
        <main className="ml-[272px] p-6 pr-0"> 
          

          {displayed.length === 0 ? (
            <p className="text-center opacity-70">
              No skills{" "}
              {filter === "completed" ? "completed" : filter === "all" ? "" : "in progress"}{" "}
              {category && <>in ‚Äú{category}‚Äù</>}.
            </p>
          ) : (
            <div className="flex flex-col gap-6">
              {displayed.map((s) => {
                const total = s.tasks.length;
                const done  = s.completedTasks.filter(Boolean).length;
                const pct   = total ? Math.round((done / total) * 100) : 0;

                return (
                  <div key={s._id} className="w-full">
                    <SkillCard skill={s} to={`/dashboard/${s._id}`} progress={pct} />
                  </div>
                );
              })}
            </div>
          )}
        </main>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\DashboardSkillDetailPage.jsx =====
import { useEffect, useState } from "react";
import { useParams, Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import SkillProgressBar from "../../components/user/SkillProgressBar";

export default function DashboardSkillDetailPage() {
  const { id: skillId } = useParams();
  const [entry, setEntry] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    api.get(`/learning/${skillId}`)
      .then((res) => setEntry(res.data))
      .catch(() => toast.error("Could not load skill details"))
      .finally(() => setLoading(false));
  }, [skillId]);

  if (loading) {
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-lg"></span>
      </div>
    );
  }
  if (!entry) {
    return <p className="text-center py-20">Skill not found.</p>;
  }

  const stageSrc = (p) => {
    if (p === 0)   return "/trees/seed.png";
    if (p < 25)    return "/trees/sprout.png";
    if (p < 50)    return "/trees/small-plant.png";
    if (p < 75)    return "/trees/young-tree.png";
    if (p < 100)   return "/trees/leafy-tree.png";
    return "/trees/full-tree.png";
  };

  const xpPerTask = entry.xpPerTask ?? 10;
  const totalTasks = entry.tasks.length;
  const doneTasks  = entry.completedTasks.filter(Boolean).length;
  const pct        = totalTasks ? Math.round((doneTasks / totalTasks) * 100) : 0;

  const handleToggle = async (index) => {
    try {
      const { data } = await api.patch(`/learning/${skillId}/task/${index}`);
      setEntry((prev) => ({ ...prev, completedTasks: data.completedTasks }));

      // Refresh navbar XP badge
      if (typeof data?.xp === "number") {
        window.dispatchEvent(new CustomEvent("xp:update", { detail: { xp: data.xp } }));
      }
      // Refresh navbar COINS badge
      if (typeof data?.coins === "number") {
        window.dispatchEvent(new CustomEvent("coins:update", { detail: { coins: data.coins } }));
      }

      // XP toast
      if (typeof data?.deltaXp === "number" && data.deltaXp !== 0) {
        const sign = data.deltaXp > 0 ? "+" : "";
        toast.success(`${sign}${data.deltaXp} XP`);
      }

      // COINS toast(s)
      if (typeof data?.deltaCoins === "number" && data.deltaCoins > 0) {
        toast.success(`+${data.deltaCoins} coins`);
      }
      if (Array.isArray(data?.awardedMilestones) && data.awardedMilestones.length) {
        data.awardedMilestones.forEach((t) =>
          toast.success(`Milestone ${t}%! +${data.milestoneBonuses?.[t] ?? ""} coins`)
        );
      }

      // Trigger daily streak tick only on mark-as-done
      if (data?.deltaXp && data.deltaXp > 0) {
        try {
          const streak = await api.post("/streak/tick");
          if (typeof streak?.data?.coins === "number") {
            window.dispatchEvent(new CustomEvent("coins:update", { detail: { coins: streak.data.coins } }));
          }
          if (streak?.data?.deltaCoins > 0) {
            toast.success(`Daily streak +${streak.data.deltaCoins} coins`);
          }
        } catch { /* no-op */ }
      }
    } catch {
      toast.error("Could not update that task");
    }
  };

  const earnedXp = doneTasks * xpPerTask;
  const totalEarnableXp = totalTasks * xpPerTask;

  return (
    <div className="min-h-screen bg-neutral p-6">
      <div className="max-w-3xl mx-auto space-y-6">
        <div className="flex items-center justify-between">
          <Link to="/dashboard" className="btn btn-ghost">
            ‚Üê Back to Dashboard
          </Link>
          {/* Per-skill XP (done/total_earnable) */}
          <div className="badge badge-primary px-4 py-3 text-sm">
            XP: {earnedXp}/{totalEarnableXp}
          </div>
        </div>

        <div className="card bg-base-100 shadow">
          <div className="card-body">
            <h1 className="text-2xl font-bold mb-1">{entry.name}</h1>
            <p className="text-sm opacity-70 mb-2">{entry.category}</p>

            <div className="flex flex-col items-center mb-4 w-full">
              <img
                src={stageSrc(pct)}
                alt="Skill growth stage"
                className="w-40 h-40 object-contain"
              />
              <div className="w-full mt-2">
                <SkillProgressBar percent={pct} />
              </div>
              <div className="text-sm opacity-70 mt-2">{pct}% complete</div>
            </div>

            <h2 className="text-lg font-semibold mb-2">Tasks</h2>
            {entry.tasks.length === 0 ? (
              <p className="opacity-70">No tasks defined for this skill.</p>
            ) : (
              <ul className="space-y-4">
                {entry.tasks.map((t, i) => (
                  <li
                    key={i}
                    className="flex items-start justify-between border-l-4 border-primary pl-4"
                  >
                    <div>
                      <h3 className="font-medium">{t.title}</h3>
                      <p className="text-sm opacity-80 whitespace-pre-wrap">
                        {t.content}
                      </p>
                    </div>
                    <button
                      className={`btn btn-sm ${
                        entry.completedTasks[i] ? "btn-success" : "btn-outline"
                      }`}
                      onClick={() => handleToggle(i)}
                    >
                      {entry.completedTasks[i] ? "‚úì Done" : "Mark Done"}
                    </button>
                  </li>
                ))}
              </ul>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\LeaderboardPage.jsx =====
import { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import RankBadge from "../../components/user/RankBadge";
import { TrophyIcon } from "lucide-react";

export default function LeaderboardPage() {
  const [rows, setRows] = useState([]);
  const [me, setMe] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const load = async () => {
      try {
        const { data } = await api.get("/users/leaderboard?limit=100&offset=0");
        setRows(data.items || []);
        setMe(data.me || null);
      } catch {
        toast.error("Could not load leaderboard");
      } finally {
        setLoading(false);
      }
    };
    load();
  }, []);

  if (loading) {
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-lg"></span>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-neutral p-6">
      <div className="max-w-3xl mx-auto space-y-6">
        <div className="flex items-center justify-between">
          <Link to="/dashboard" className="btn btn-ghost">‚Üê Back</Link>
          <h1 className="text-2xl font-bold flex items-center gap-2">
            <TrophyIcon className="h-6 w-6 text-primary" />
            Global Leaderboard
          </h1>
          <div />
        </div>

        <div className="card bg-base-100 shadow">
          <div className="card-body p-0">
            <div className="overflow-x-auto">
              <table className="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>User</th>
                    <th>Rank</th>
                    <th className="text-right">XP</th>
                  </tr>
                </thead>
                <tbody>
                  {rows.map((r) => (
                    <tr key={`${r.position}-${r.username}`} className={r.position === me?.position ? "bg-secondary/10" : ""}>
                      <td className="font-semibold">{r.position}</td>
                      <td className="font-medium">{r.username}</td>
                      <td>
                        <RankBadge rank={r.rank} />
                      </td>
                      <td className="text-right">{r.xp}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {me && (
              <div className="p-4 border-t text-sm opacity-80">
                You are currently <span className="font-semibold">#{me.position}</span> with{" "}
                <span className="font-semibold">{me.xp}</span> XP.
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\LoginPage.jsx =====
import { useState } from "react";
import { useNavigate, Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import { saveToken, saveIsAdmin } from "../../lib/auth";

export default function LoginPage() {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const nav = useNavigate();

  const handle = async (e) => {
    e.preventDefault();
    try {
      const { data } = await api.post("/auth/login", { username, password });
      saveToken(data.token);
      saveIsAdmin(data.isAdmin);

      toast.success("Welcome back!");
      if (data.isAdmin) {
        nav("/");
      } else {
        nav("/dashboard");
      }
    } catch (err) {
      // show only the toast, keep inputs as-is
      toast.error(err.response?.data?.message || "Invalid credentials");
    }
  };

  return (
    <div className="min-h-screen w-full bg-gradient-to-br from-neutral via-neutral to-neutral flex items-center justify-center p-4">
      <form
        onSubmit={handle}
        className="bg-base-100 p-6 w-full max-w-md rounded-lg shadow-lg"
      >
        <h1 className="text-2xl font-semibold text-center mb-6">Log In</h1>
        <input
          type="text"
          placeholder="Username"
          className="input input-bordered w-full mb-4"
          value={username}
          onChange={(e) => setUsername(e.target.value)}
        />
        <input
          type="password"
          placeholder="Password"
          className="input input-bordered w-full mb-6"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />
        <button type="submit" className="btn btn-primary w-full mb-4">
          Enter
        </button>
        <p className="text-center">
          Don‚Äôt have an account?{" "}
          <Link to="/register" className="text-blue-700 underline">
            Sign Up
          </Link>
        </p>
      </form>
    </div>
  );
}


===== FILE: frontend\src\views\user\ProfilePage.jsx =====
import { useEffect, useState, useMemo } from "react";
import { Link } from "react-router-dom";
import toast from "react-hot-toast";
import { TrophyIcon, CoinsIcon, AwardIcon, MedalIcon, CrownIcon, GemIcon, StarIcon, SparklesIcon, PackageIcon } from "lucide-react";
import api from "../../lib/axios";
import { formatDate } from "../../lib/utils";

const RANK_STYLES = {
  unranked: { bg: "bg-base-200", text: "text-base-content", ring: "ring-base-300", Icon: StarIcon },
  bronze:   { bg: "bg-amber-200", text: "text-amber-900",   ring: "ring-amber-300", Icon: MedalIcon },
  silver:   { bg: "bg-gray-200",  text: "text-gray-900",    ring: "ring-gray-300",  Icon: AwardIcon },
  gold:     { bg: "bg-yellow-200",text: "text-yellow-900",  ring: "ring-yellow-300",Icon: CrownIcon },
  diamond:  { bg: "bg-cyan-200",  text: "text-cyan-900",    ring: "ring-cyan-300",  Icon: GemIcon },
  mythic:   { bg: "bg-purple-200",text: "text-purple-900",  ring: "ring-purple-300",Icon: SparklesIcon},
};

export default function ProfilePage() {
  const [me, setMe] = useState(null);
  const [catalog, setCatalog] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    Promise.all([api.get("/users/me"), api.get("/shop/items")])
      .then(([meRes, shopRes]) => {
        setMe(meRes.data);
        setCatalog(shopRes.data || []);
      })
      .catch(() => toast.error("Could not load profile"))
      .finally(() => setTimeout(() => setLoading(false), 0));
  }, []);

  const nameById = useMemo(() => {
    const map = new Map();
    for (const it of catalog) map.set(it.id, it.name);
    return map;
  }, [catalog]);

  const iconById = useMemo(() => {
    const map = new Map();
    for (const it of catalog) map.set(it.id, it.icon || `/shop/${it.id}.png`);
    return map;
  }, [catalog]);

  if (loading) {
    return (
      <div className="flex justify-center py-24">
        <span className="loading loading-spinner loading-lg"></span>
      </div>
    );
  }

  if (!me) return <p className="text-center py-24">Profile unavailable.</p>;

  const progress = me.rank?.progressToNext ?? 0;
  const nextName = me.rank?.next?.name || null;
  const toNext   = me.rank?.toNext ?? 0;
  const rankKey  = me.rank?.current?.key || "unranked";
  const rankName = me.rank?.current?.name || "Unranked";
  const c = RANK_STYLES[rankKey] || RANK_STYLES.unranked;
  const Icon = c.Icon;

  return (
    <div className="min-h-[calc(100vh-4rem)] px-4 sm:px-6 py-6">
      <div className="max-w-3xl mx-auto space-y-6">
        <div className="flex items-center justify-between">
          <Link to="/dashboard" className="btn btn-ghost btn-sm">‚Üê Back</Link>
          <h1 className="text-xl sm:text-2xl font-bold">My Profile</h1>
          <div className="w-14" aria-hidden />
        </div>

        <section className="card bg-base-100 shadow-md">
          <div className="card-body p-5 sm:p-8 space-y-8">
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div>
                <p className="text-xs uppercase opacity-60">Username</p>
                <p className="text-lg font-semibold break-all">{me.username}</p>
              </div>

              <div className="flex items-center gap-2">
                <span className="badge badge-primary px-3 py-2 text-xs sm:text-sm flex items-center gap-1">
                  <TrophyIcon className="h-4 w-4" />
                  <span>XP {me.xp}</span>
                </span>
                <span className="badge bg-amber-200 text-amber-900 px-3 py-2 text-xs sm:text-sm flex items-center gap-1">
                  <CoinsIcon className="h-4 w-4" />
                  <span>{me.coins} coins</span>
                </span>
              </div>
            </div>

            <div className="flex flex-col items-center text-center">
              <div className={["rounded-full ring-4 ring-offset-2 shadow", c.bg, c.text, c.ring, "w-40 h-40 sm:w-44 sm:h-44", "flex items-center justify-center"].join(" ")}>
                <Icon className="w-16 h-16 sm:w-20 sm:h-20" />
              </div>
              <div className="mt-3 font-semibold">{rankName}</div>
              <div className="text-sm opacity-70">Your current rank</div>

              <div className="mt-6 w-full">
                <p className="text-sm opacity-70 mb-3">
                  {nextName ? <>Progress to <span className="font-medium">{nextName}</span> ‚Äî {progress}% ({toNext} XP left)</> : <>Top rank reached</>}
                </p>
                <div className="w-full bg-base-200 h-3 rounded-xl overflow-hidden">
                  <div className="h-3 bg-primary rounded-xl transition-[width] duration-500 ease-out" style={{ width: `${progress}%` }} />
                </div>
              </div>
            </div>

            <div className="grid sm:grid-cols-2 gap-4">
              <div className="p-4 rounded-lg bg-base-200/60">
                <p className="text-xs uppercase opacity-60">Member since</p>
                <p className="font-medium">{me.createdAt ? formatDate(new Date(me.createdAt)) : "‚Äî"}</p>
              </div>
              {me.isAdmin && (
                <div className="p-4 rounded-lg bg-info/10 border border-info/30">
                  <p className="font-medium">Admin</p>
                  <p className="text-sm opacity-80">You have administrator privileges.</p>
                </div>
              )}
            </div>
          </div>
        </section>

        {/* Inventory with icons */}
        <section className="card bg-base-100 shadow-md">
          <div className="card-body">
            <h2 className="text-lg font-semibold flex items-center gap-2">
              <PackageIcon className="h-5 w-5 text-primary" />
              Inventory
            </h2>

            {!me.inventory || me.inventory.length === 0 ? (
              <p className="opacity-70 mt-2">No items yet. Visit the Shop to buy decorations.</p>
            ) : (
              <div className="grid gap-4 sm:grid-cols-2">
                {me.inventory.map((it, idx) => {
                  const name = nameById.get(it.itemId) || it.itemId;
                  const src  = iconById.get(it.itemId) || `/shop/${it.itemId}.png`;
                  return (
                    <div key={`${it.itemId}-${idx}`} className="p-3 border border-primary bg-base-100 flex items-center gap-3">
                      <div className="relative w-12 h-12 bg-base-200 flex items-center justify-center">
                        <img
                          src={src}
                          alt={name}
                          className="w-12 h-12 object-contain"
                          style={{ imageRendering: "pixelated" }}
                          onError={(e) => { e.currentTarget.style.display = 'none'; }}
                        />
                        <span className="absolute -right-1 -bottom-1 badge badge-primary badge-sm">x{it.qty}</span>
                      </div>
                      <div className="flex-1">
                        <div className="font-medium">{name}</div>
                        <div className="text-xs opacity-70">Qty: {it.qty}</div>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </section>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\RegisterPage.jsx =====
import { useState } from "react";
import { useNavigate, Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import { saveToken, saveIsAdmin } from "../../lib/auth";

export default function RegisterPage() {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const nav = useNavigate();

  const handle = async (e) => {
    e.preventDefault();
    try {
      const { data } = await api.post("/auth/register", { username, password });
      saveToken(data.token);
      saveIsAdmin(data.isAdmin);
      toast.success("Account created!");
      if (data.isAdmin) {
        nav("/");
      } else {
        nav("/dashboard");
      }
    } catch (err) {
      toast.error(err.response?.data?.message || "Registration failed");
    }
  };

  return (
    <div className="min-h-screen w-full bg-gradient-to-br from-neutral via-neutral to-neutral flex items-center justify-center p-4">
      <form
        onSubmit={handle}
        className="bg-base-100 p-6 w-full max-w-md rounded-lg shadow-lg"
      >
        <h1 className="text-2xl font-semibold text-center mb-6">Sign Up</h1>
        <input
          type="text"
          placeholder="Username"
          className="input input-bordered w-full mb-4"
          value={username}
          onChange={(e) => setUsername(e.target.value)}
        />
        <input
          type="password"
          placeholder="Password"
          className="input input-bordered w-full mb-6"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />
        <button className="btn btn-primary w-full mb-4">Create</button>
        <p className="text-center">
          Already have one?{" "}
          <Link to="/login" className="text-blue-800 underline">
            Log In
          </Link>
        </p>
      </form>
    </div>
  );
}

===== FILE: frontend\src\views\user\ShopPage.jsx =====
import { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import { CoinsIcon, ShoppingCartIcon } from "lucide-react";

export default function ShopPage() {
  const [items, setItems] = useState([]);
  const [coins, setCoins] = useState(null);
  const [buying, setBuying] = useState(null);

  const load = async () => {
    try {
      const [shop, me] = await Promise.all([
        api.get("/shop/items"),
        api.get("/users/me"),
      ]);
      setItems(shop.data || []);
      setCoins(typeof me?.data?.coins === "number" ? me.data.coins : 0);
    } catch {
      toast.error("Could not load shop");
    }
  };

  useEffect(() => { load(); }, []);

  const buy = async (itemId) => {
    setBuying(itemId);
    try {
      const { data } = await api.post(`/shop/buy/${itemId}`);
      setCoins(data.coins);
      window.dispatchEvent(new CustomEvent("coins:update", { detail: { coins: data.coins } }));
      toast.success(`Purchased ${data?.purchased?.name || "item"}!`);
    } catch (e) {
      toast.error(e?.response?.data?.message || "Purchase failed");
    } finally {
      setBuying(null);
    }
  };

  return (
    <div className="min-h-screen bg-neutral p-6">
      <div className="max-w-4xl mx-auto space-y-6">
        <div className="flex items-center justify-between">
          <Link to="/dashboard" className="btn btn-ghost">‚Üê Back</Link>
          <h1 className="text-2xl font-bold">Forest Shop</h1>
          <div className="badge bg-amber-200 text-amber-900 px-3 py-2 flex items-center gap-1">
            <CoinsIcon className="h-4 w-4" />
            <span>{coins ?? "‚Äî"} coins</span>
          </div>
        </div>

        <div className="card bg-base-100 shadow">
          <div className="card-body">
            {items.length === 0 ? (
              <p className="opacity-70">No items available.</p>
            ) : (
              <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                {items.map((it) => {
                  const afford = typeof coins === "number" ? coins >= it.price : true;
                  const src = it.icon || `/shop/${it.id}.png`;
                  return (
                    <div key={it.id} className="p-4 border border-primary bg-base-100 shadow flex flex-col">
                      {/* Item icon */}
                      <div className="w-full h-32 bg-base-200 flex items-center justify-center mb-3">
                        <img
                          src={src}
                          alt={it.name}
                          className="w-20 h-20 object-contain"
                          style={{ imageRendering: "pixelated" }}
                          onError={(e) => { e.currentTarget.style.display = 'none'; }}
                        />
                      </div>

                      <div className="flex-1">
                        <h3 className="font-semibold">{it.name}</h3>
                        <p className="text-sm opacity-70 mt-1">{it.desc}</p>
                      </div>

                      <div className="mt-4 flex items-center justify-between">
                        <span className="badge bg-amber-200 text-amber-900">
                          {it.price} coins
                        </span>
                        <button
                          className={`btn btn-primary btn-sm ${!afford ? "btn-disabled" : ""}`}
                          disabled={!afford || buying === it.id}
                          onClick={() => buy(it.id)}
                        >
                          {buying === it.id ? (
                            <span className="loading loading-xs" />
                          ) : (
                            <>
                              <ShoppingCartIcon className="h-4 w-4 mr-1" />
                              Buy
                            </>
                          )}
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
            <p className="text-xs opacity-60 mt-4">
              Icons are pixel-art PNGs (64√ó64, transparent). Missing image? Check <code>/public/shop/</code>.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\SkillForestPage.jsx =====
import { useEffect, useMemo, useRef, useState } from "react";
import { Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";
import { SaveIcon, XIcon, PackageIcon, MousePointerClickIcon } from "lucide-react";

function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }
function toPct(px, total) { return total ? clamp((px / total) * 100, 0, 100) : 0; }
function uuid() { return (globalThis.crypto?.randomUUID?.() || Math.random().toString(36).slice(2)); }

export default function SkillForestPage() {
  const [learning, setLearning] = useState([]);
  const [loading, setLoading] = useState(true);

  const [inventory, setInventory] = useState([]);
  const [catalog, setCatalog] = useState([]);

  // saved decorations per skill (shown on forest)
  const [decosMap, setDecosMap] = useState({}); // { skillId: Decoration[] }

  // overlay editor state
  const [overlayFor, setOverlayFor] = useState(null); // entry from learning
  const [workDecos, setWorkDecos] = useState([]);     // working layout
  const [overlayInv, setOverlayInv] = useState([]);   // working inventory (qty changes immediately)
  const [armedItem, setArmedItem] = useState(null);
  const [saving, setSaving] = useState(false);

  const canvasRef = useRef(null);
  const draggingRef = useRef(null); // { id, dx, dy }
  const movedRef = useRef(false);
  const suppressNextClickRef = useRef(false);

  // sizing
  const TREE_BOX = "w-40 h-40";                 // tree sprite box
  const OVERLAY_ITEM_SIZE = "w-24 h-24";        // 2√ó bigger (overlay)
  const FOREST_ITEM_SIZE  = "w-8 h-8";        // 2√ó bigger (on forest)

  useEffect(() => {
    const load = async () => {
      try {
        const [learn, me, shop] = await Promise.all([
          api.get("/learning"),
          api.get("/users/me"),
          api.get("/shop/items"),
        ]);
        setLearning(learn.data || []);
        setInventory(me.data?.inventory || []);
        setCatalog(shop.data || []);
      } catch {
        toast.error("Could not load your forest");
      } finally {
        setLoading(false);
      }
    };
    load();
  }, []);

  // prefetch saved decorations for 100% trees
  useEffect(() => {
    const run = async () => {
      const reqs = learning.map(async (e) => {
        const total = e.tasks.length;
        const done  = e.completedTasks.filter(Boolean).length;
        const pct   = total ? Math.round((done / total) * 100) : 0;
        if (pct !== 100) return null;
        try {
          const { data } = await api.get(`/learning/${e._id}/decorations`);
          return { id: e._id, decorations: data?.decorations || [] };
        } catch { return null; }
      });
      const results = await Promise.all(reqs);
      const map = {};
      for (const r of results) if (r) map[r.id] = r.decorations;
      setDecosMap(map);
    };
    if (learning.length) run();
  }, [learning]);

  const iconById = useMemo(() => {
    const m = new Map();
    for (const it of catalog) m.set(it.id, it.icon || `/shop/${it.id}.png`);
    return m;
  }, [catalog]);

  if (loading) {
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-lg" />
      </div>
    );
  }

  const stageSrc = (p) => {
    if (p === 0) return "/trees/seed.png";
    if (p < 25) return "/trees/sprout.png";
    if (p < 50) return "/trees/small-plant.png";
    if (p < 75) return "/trees/young-tree.png";
    if (p < 100) return "/trees/leafy-tree.png";
    return "/trees/full-tree.png";
  };
  const progressOf = (e) => {
    const t = e.tasks.length;
    const d = e.completedTasks.filter(Boolean).length;
    return t ? Math.round((d / t) * 100) : 0;
  };

  // ---------- Overlay open/close ----------
  async function openOverlay(entry) {
    const pct = progressOf(entry);
    if (pct < 100) {
      toast.error("Only fully-grown (100%) trees can be decorated.");
      return;
    }
    try {
      const [{ data: decos }, { data: me }] = await Promise.all([
        api.get(`/learning/${entry._id}/decorations`),
        api.get("/users/me"),
      ]);
      setOverlayFor(entry);
      setWorkDecos(decos?.decorations || []);
      // start with a local, mutable copy of inventory for immediate qty changes
      setOverlayInv((me?.inventory || []).map((x) => ({ ...x })));
      setArmedItem(null);
    } catch {
      toast.error("Could not load decorator");
    }
  }
  function closeOverlay() {
    setOverlayFor(null);
    setWorkDecos([]);
    setOverlayInv([]);
    setArmedItem(null);
  }

  function onTreeContext(ev, entry) {
    ev.preventDefault();
    openOverlay(entry);
  }

  // ---------- Inventory helpers (overlay) ----------
  function invQty(itemId) {
    return overlayInv.find(i => i.itemId === itemId)?.qty ?? 0;
  }
  function addQty(itemId, n) {
    setOverlayInv(prev => {
      const copy = prev.map(i => ({ ...i }));
      const found = copy.find(i => i.itemId === itemId);
      if (found) found.qty = Math.max(0, found.qty + n);
      else copy.push({ itemId, qty: Math.max(0, n), acquiredAt: new Date() });
      return copy;
    });
  }

  // ---------- Place item by clicking canvas ----------
  function onCanvasClick(e) {
    if (suppressNextClickRef.current) { // swallow post-drag click
      suppressNextClickRef.current = false;
      return;
    }
    if (!armedItem) return;

    const leftBtn = e.button === 0 || e.button === undefined;
    if (!leftBtn) return;

    const box = canvasRef.current?.getBoundingClientRect();
    if (!box) return;

    const leftQty = invQty(armedItem);
    if (leftQty <= 0) {
      toast.error("Out of stock for this item");
      setArmedItem(null);
      return;
    }

    const xPct = toPct(e.clientX - box.left, box.width);
    const yPct = toPct(e.clientY - box.top,  box.height);

    setWorkDecos(prev => [...prev, { id: uuid(), itemId: armedItem, xPct, yPct }]);
    addQty(armedItem, -1); // decrement immediately

    // keep armed so user can place multiples; auto-disarm if runs out
    if (invQty(armedItem) - 1 <= 0) setArmedItem(null);
  }

  // ---------- Drag to move (no duplicate creation) ----------
  function onDecoMouseDown(e, deco) {
    e.stopPropagation(); // don't bubble to canvas -> prevents click add
    if (e.button === 2 || e.altKey) { // right-click or Alt = remove
      e.preventDefault();
      removeDeco(deco.id);
      return;
    }
    const box = canvasRef.current?.getBoundingClientRect();
    if (!box) return;
    const xPct = toPct(e.clientX - box.left, box.width);
    const yPct = toPct(e.clientY - box.top,  box.height);
    draggingRef.current = { id: deco.id, dx: deco.xPct - xPct, dy: deco.yPct - yPct };
    movedRef.current = false;
    window.addEventListener("mousemove", onMouseMove);
    window.addEventListener("mouseup", onMouseUp);
    e.preventDefault();
  }
  function onMouseMove(e) {
    const drag = draggingRef.current; if (!drag) return;
    movedRef.current = true;
    const box = canvasRef.current?.getBoundingClientRect(); if (!box) return;
    const xPct = toPct(e.clientX - box.left, box.width) + drag.dx;
    const yPct = toPct(e.clientY - box.top,  box.height) + drag.dy;
    setWorkDecos(prev => prev.map(d => d.id === drag.id ? ({ ...d, xPct: clamp(xPct,0,100), yPct: clamp(yPct,0,100) }) : d));
  }
  function onMouseUp() {
    if (draggingRef.current && movedRef.current) {
      // prevent the synthetic click after drag from placing a new item
      suppressNextClickRef.current = true;
    }
    draggingRef.current = null;
    movedRef.current = false;
    window.removeEventListener("mousemove", onMouseMove);
    window.removeEventListener("mouseup", onMouseUp);
  }

  // ---------- Remove placed decoration (returns qty immediately) ----------
  function removeDeco(id) {
    setWorkDecos(prev => {
      const found = prev.find(d => d.id === id);
      if (found) addQty(found.itemId, +1);
      return prev.filter(d => d.id !== id);
    });
  }

  // ---------- Save ----------
  async function saveLayout() {
    if (!overlayFor) return;
    setSaving(true);
    try {
      const { data } = await api.put(`/learning/${overlayFor._id}/decorations`, { decorations: workDecos });
      // update top-nav coins qty via /users/me is already handled in your navbar; here we sync inventory & saved layout
      setInventory(data?.inventory || inventory);
      setDecosMap(m => ({ ...m, [overlayFor._id]: data?.decorations || [] }));
      toast.success("Layout saved!");
      closeOverlay();
    } catch (e) {
      toast.error(e?.response?.data?.message || "Could not save layout");
    } finally {
      setSaving(false);
    }
  }

  return (
    <div className="min-h-screen bg-neutral p-6" onMouseUp={onMouseUp}>
      <div className="container mx-auto px-4 space-y-6">
        <div className="flex items-center justify-between">
          <Link to="/dashboard" className="btn btn-ghost text-lg">‚Üê Back</Link>
          <h1 className="text-2xl font-bold">My Skill Forest</h1>
          <div />
        </div>

        <div className="card bg-base-100 shadow">
          <div className="card-body">
            <div
              className="rounded-xl border border-primary bg-secondary-content/40 p-3 bg-bottom bg-cover"
              style={{ backgroundImage: "url('/forest/forest-bg.png')", imageRendering: "pixelated" }}
            >
              <div className="min-h-[600px] overflow-x-auto">
                <div className="grid grid-flow-col auto-cols-max items-end gap-0 h-[460px] px-4 ml-6">
                  {learning.length === 0 ? (
                    <p className="opacity-70 col-span-full py-24">No trees yet. Start learning from the Skills page.</p>
                  ) : (
                    learning.map((e) => {
                      const pct = progressOf(e);
                      const canDecorate = pct === 100;
                      const list = decosMap[e._id] || [];
                      return (
                        <div
                          key={e._id}
                          className={`tooltip tooltip-top -ml-6 ${canDecorate ? "cursor-context-menu" : ""}`}
                          data-tip={`${e.name} ‚Äî ${pct}%`}
                          onContextMenu={(ev) => onTreeContext(ev, e)}
                        >
                          <div className={`relative ${TREE_BOX} mb-[-2px]`}>
                            <img
                              src={stageSrc(pct)}
                              alt={e.name}
                              className={`absolute inset-0 ${TREE_BOX} object-contain transition-transform hover:scale-110`}
                              style={{ imageRendering: "pixelated" }}
                            />
                            {canDecorate && list.map(d => {
                              const src = iconById.get(d.itemId) || `/shop/${d.itemId}.png`;
                              return (
                                <img
                                  key={d.id}
                                  src={src}
                                  alt={d.itemId}
                                  className={`absolute ${FOREST_ITEM_SIZE} -translate-x-1/2 -translate-y-1/2 pointer-events-none`}
                                  style={{ left: `${d.xPct}%`, top: `${d.yPct}%`, imageRendering: "pixelated" }}
                                  onError={(ev) => { ev.currentTarget.style.display = 'none'; }}
                                />
                              );
                            })}
                          </div>
                        </div>
                      );
                    })
                  )}
                </div>
              </div>
            </div>

            <div className="mt-3 text-sm opacity-80 flex items-center gap-2">
              <MousePointerClickIcon className="h-4 w-4" />
              Right-click a 100% tree to open the decorator. Click an item to place (consumes 1), drag to move, Alt/right-click to remove.
            </div>
          </div>
        </div>
      </div>

      {/* ===== Overlay editor ===== */}
      {overlayFor && (
        <div className="fixed inset-0 z-40 bg-black/40 flex items-center justify-center" onContextMenu={(e) => e.preventDefault()}>
          <div className="bg-base-100 w-full max-w-5xl rounded-lg shadow-xl border border-primary overflow-hidden">
            <div className="p-4 border-b flex items-center justify-between">
              <div className="flex items-center gap-2">
                <PackageIcon className="h-5 w-5 text-primary" />
                <div className="font-semibold">Decorate: {overlayFor.name}</div>
              </div>
              <div className="flex items-center gap-2">
                <button className="btn btn-ghost btn-sm" onClick={closeOverlay}>
                  <XIcon className="h-4 w-4 mr-1" /> Cancel
                </button>
                <button className={`btn btn-primary btn-sm ${saving ? "btn-disabled" : ""}`} onClick={saveLayout} disabled={saving}>
                  {saving ? <span className="loading loading-xs" /> : <><SaveIcon className="h-4 w-4 mr-1" /> Save Layout</>}
                </button>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-5">
              {/* Canvas */}
              <div className="md:col-span-3 p-4">
                <div
                  ref={canvasRef}
                  className="relative w-full aspect-square bg-base-200 border border-primary flex items-center justify-center"
                  onClick={onCanvasClick}
                >
                  <img
                    src={"/trees/full-tree.png"}
                    alt="Tree"
                    className="max-h-full max-w-full object-contain"
                    style={{ imageRendering: "pixelated" }}
                  />
                  {workDecos.map(d => {
                    const src = iconById.get(d.itemId) || `/shop/${d.itemId}.png`;
                    return (
                      <img
                        key={d.id}
                        src={src}
                        alt={d.itemId}
                        className={`absolute ${OVERLAY_ITEM_SIZE} -translate-x-1/2 -translate-y-1/2 cursor-move select-none`}
                        style={{ left: `${d.xPct}%`, top: `${d.yPct}%`, imageRendering: "pixelated" }}
                        draggable={false}
                        onMouseDown={(e) => onDecoMouseDown(e, d)}
                        onError={(ev) => { ev.currentTarget.style.display = 'none'; }}
                        title="Drag to move ¬∑ Alt/right-click to remove"
                      />
                    );
                  })}
                </div>
                <div className="mt-2 text-xs opacity-70">
                  Tip: Click the canvas to drop an armed item. Drag items to reposition.
                </div>
              </div>

              {/* Inventory */}
              <div className="md:col-span-2 p-4 border-t md:border-t-0 md:border-l">
                <h3 className="font-semibold mb-3 flex items-center gap-2">
                  <PackageIcon className="h-4 w-4 text-primary" /> Inventory
                </h3>

                {(!overlayInv || overlayInv.length === 0) ? (
                  <p className="opacity-70">No items yet. Buy some in the <Link to="/shop" className="link link-primary">Shop</Link>.</p>
                ) : (
                  <div className="grid gap-3 sm:grid-cols-2">
                    {overlayInv.map((it, idx) => {
                      const src = iconById.get(it.itemId) || `/shop/${it.itemId}.png`;
                      const qtyLeft = invQty(it.itemId);
                      const isArmed = armedItem === it.itemId;
                      return (
                        <button
                          key={`${it.itemId}-${idx}`}
                          className={`p-2 border bg-base-100 text-left ${qtyLeft ? "hover:bg-base-200" : "opacity-50"} ${isArmed ? "outline outline-2 outline-primary" : ""}`}
                          disabled={!qtyLeft}
                          onClick={() => setArmedItem(isArmed ? null : it.itemId)}
                          title={qtyLeft ? "Click to arm for placement" : "Out of stock"}
                        >
                          <div className="flex items-center gap-3">
                            <div className="relative w-14 h-14 bg-base-200 flex items-center justify-center">
                              <img
                                src={src}
                                alt={it.itemId}
                                className="w-14 h-14 object-contain"
                                style={{ imageRendering: "pixelated" }}
                                onError={(ev) => { ev.currentTarget.style.display = 'none'; }}
                              />
                              <span className="absolute -right-1 -bottom-1 badge badge-primary badge-sm">x{qtyLeft}</span>
                            </div>
                            <div className="flex-1">
                              <div className="font-medium text-sm">{it.itemId}</div>
                              <div className="text-xs opacity-70">{isArmed ? "Armed" : "Click to arm"}</div>
                            </div>
                          </div>
                        </button>
                      );
                    })}
                  </div>
                )}

                {armedItem && (
                  <div className="mt-3 text-xs opacity-70">
                    Armed: <span className="font-semibold">{armedItem}</span> ‚Äî click the tree canvas to place (uses 1).
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


===== FILE: frontend\src\views\user\UserSkillDetailPage.jsx =====
import { useEffect, useState } from "react";
import { useParams, Link } from "react-router-dom";
import api from "../../lib/axios";
import toast from "react-hot-toast";

export default function UserSkillDetailPage() {
  const { id } = useParams();
  const [skill, setSkill]     = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    api.get(`/skills/${id}`)
      .then((res) => setSkill(res.data))
      .catch(() => toast.error("Could not load skill"))
      .finally(() => setLoading(false));
  }, [id]);

  if (loading)
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-lg"></span>
      </div>
    );

  if (!skill) return <p className="text-center py-20">Skill not found.</p>;

  return (
    <div className="min-h-screen w-full bg-neutral p-6 overflow-auto">
      <div className="max-w-3xl mx-auto space-y-8">
        <div className="flex items-center justify-between">
          <Link to="/skills" className="btn btn-ghost">‚Üê Back</Link>
        </div>

        <div className="card bg-base-100 shadow">
          <div className="card-body">
            <h1 className="card-title text-2xl mb-2">{skill.name}</h1>
            <p className="text-sm opacity-70 mb-6">{skill.category}</p>

            <h2 className="text-lg font-semibold mb-3">Tasks</h2>
            {skill.tasks.length === 0 ? (
              <p className="opacity-70">No tasks for this skill yet.</p>
            ) : (
              <ul className="space-y-4">
                {skill.tasks.map((t, i) => (
                  <li key={i} className="border-l-4 border-primary pl-4">
                    <h3 className="font-medium">{t.title}</h3>
                    <p className="text-sm opacity-80 whitespace-pre-wrap">
                      {t.content}
                    </p>
                  </li>
                ))}
              </ul>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


===== FILE: frontend\src\views\user\UserSkillsListPage.jsx =====
// frontend/src/views/user/UserSkillsListPage.jsx
import { useEffect, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { BookOpenIcon, PlusCircleIcon, CheckCircle2Icon } from "lucide-react";
import api from "../../lib/axios";
import toast from "react-hot-toast";

export default function UserSkillsListPage() {
  const [skills, setSkills]     = useState([]);
  const [loading, setLoading]   = useState(true);
  const [learning, setLearning] = useState([]);
  const navigate = useNavigate();

  // load all skills + which ones the user is already learning
  useEffect(() => {
    api.get("/skills")
      .then((res) => setSkills(res.data))
      .catch(() => toast.error("Failed to load skills"))
      .finally(() => setLoading(false));

    api.get("/learning")
      .then((res) => setLearning(res.data.map((s) => s._id)))
      .catch(() => toast.error("Could not load your learning"));
  }, []);

  // start learning a skill
  const handleStart = async (e, id) => {
    e.stopPropagation();
    try {
      await api.post(`/learning/${id}`);
      setLearning((prev) => [...prev, id]);
      toast.success("Skill added to your dashboard!");
    } catch {
      toast.error("Could not start learning");
    }
  };

  if (loading) {
    return (
      <div className="flex justify-center py-20">
        <span className="loading loading-spinner loading-xl" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-neutral p-6 overflow-auto">
      <div className="container mx-auto px-4">
        <h1 className="text-3xl font-bold mb-6 text-neutral flex items-center space-x-2">
          <BookOpenIcon className="h-6 w-6" />
          <span>All Skills</span>
        </h1>

        {skills.length === 0 ? (
          <p className="text-center">No skills available.</p>
        ) : (
          <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {skills.map((s) => {
              const isLearning = learning.includes(s._id);
              return (
                <div
                  key={s._id}
                  onClick={() => navigate(`/skills/${s._id}`)}
                  className="
                    bg-base-100 p-5 shadow hover:shadow-lg
                    transition cursor-pointer border border-primary
                  "
                >
                  <h2 className="text-xl font-semibold mb-2">{s.name}</h2>
                  <p className="text-sm opacity-75">{s.category}</p>
                  <p className="text-xs opacity-50 mt-2">
                    {s.tasks.length} task{s.tasks.length !== 1 && "s"}
                  </p>
                  <button
                    className="btn btn-primary btn-sm mt-4 w-full flex items-center justify-center space-x-2"
                    disabled={isLearning}
                    onClick={(e) => handleStart(e, s._id)}
                  >
                    {isLearning ? (
                      <>
                        <CheckCircle2Icon className="h-4 w-4" />
                        <span>Learning ‚úì</span>
                      </>
                    ) : (
                      <>
                        <PlusCircleIcon className="h-4 w-4" />
                        <span>Start Learning</span>
                      </>
                    )}
                  </button>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
}

